(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.RoomRTC = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function after(o,n,t){function r(o,e){if(r.count<=0)throw new Error("after called too many times");--r.count,o?(u=!0,n(o),n=t):0!==r.count||u||n(null,e)}var u=!1;return t=t||noop,r.count=o,0===o?n():r}function noop(){}module.exports=after;
},{}],2:[function(require,module,exports){
module.exports=function(r,e,n){var t=r.byteLength;if(e=e||0,n=n||t,r.slice)return r.slice(e,n);if(e<0&&(e+=t),n<0&&(n+=t),n>t&&(n=t),e>=t||e>=n||0===t)return new ArrayBuffer(0);for(var f=new Uint8Array(r),i=new Uint8Array(n-e),u=e,a=0;u<n;u++,a++)i[a]=f[u];return i.buffer};
},{}],3:[function(require,module,exports){
"use strict";function throwFirstError(){if(pendingErrors.length)throw pendingErrors.shift()}function asap(r){var s;s=freeTasks.length?freeTasks.pop():new RawTask,s.task=r,rawAsap(s)}function RawTask(){this.task=null}var rawAsap=require("./raw"),freeTasks=[],pendingErrors=[],requestErrorThrow=rawAsap.makeRequestCallFromTimer(throwFirstError);module.exports=asap,RawTask.prototype.call=function(){try{this.task.call()}catch(r){asap.onerror?asap.onerror(r):(pendingErrors.push(r),requestErrorThrow())}finally{this.task=null,freeTasks[freeTasks.length]=this}};
},{"./raw":4}],4:[function(require,module,exports){
(function (global){
"use strict";function rawAsap(e){queue.length||(requestFlush(),flushing=!0),queue[queue.length]=e}function flush(){for(;index<queue.length;){var e=index;if(index+=1,queue[e].call(),index>capacity){for(var u=0,t=queue.length-index;u<t;u++)queue[u]=queue[u+index];queue.length-=index,index=0}}queue.length=0,index=0,flushing=!1}function makeRequestCallFromMutationObserver(e){var u=1,t=new BrowserMutationObserver(e),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){u=-u,r.data=u}}function makeRequestCallFromTimer(e){return function(){function u(){clearTimeout(t),clearInterval(r),e()}var t=setTimeout(u,0),r=setInterval(u,50)}}module.exports=rawAsap;var queue=[],flushing=!1,requestFlush,index=0,capacity=1024,scope="undefined"!=typeof global?global:self,BrowserMutationObserver=scope.MutationObserver||scope.WebKitMutationObserver;requestFlush="function"==typeof BrowserMutationObserver?makeRequestCallFromMutationObserver(flush):makeRequestCallFromTimer(flush),rawAsap.requestFlush=requestFlush,rawAsap.makeRequestCallFromTimer=makeRequestCallFromTimer;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],5:[function(require,module,exports){
function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}module.exports=Backoff,Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var o=Math.random(),i=Math.floor(o*this.jitter*t);t=0==(1&Math.floor(10*o))?t-i:t+i}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};
},{}],6:[function(require,module,exports){
!function(){"use strict";for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=new Uint8Array(256),t=0;t<r.length;t++)e[r.charCodeAt(t)]=t;exports.encode=function(e){var t,n=new Uint8Array(e),o=n.length,a="";for(t=0;t<o;t+=3)a+=r[n[t]>>2],a+=r[(3&n[t])<<4|n[t+1]>>4],a+=r[(15&n[t+1])<<2|n[t+2]>>6],a+=r[63&n[t+2]];return o%3===2?a=a.substring(0,a.length-1)+"=":o%3===1&&(a=a.substring(0,a.length-2)+"=="),a},exports.decode=function(r){var t,n,o,a,h,c=.75*r.length,g=r.length,i=0;"="===r[r.length-1]&&(c--,"="===r[r.length-2]&&c--);var u=new ArrayBuffer(c),A=new Uint8Array(u);for(t=0;t<g;t+=4)n=e[r.charCodeAt(t)],o=e[r.charCodeAt(t+1)],a=e[r.charCodeAt(t+2)],h=e[r.charCodeAt(t+3)],A[i++]=n<<2|o>>4,A[i++]=(15&o)<<4|a>>2,A[i++]=(3&a)<<6|63&h;return u}}();
},{}],7:[function(require,module,exports){
(function (global){
function mapArrayBufferViews(r){for(var e=0;e<r.length;e++){var o=r[e];if(o.buffer instanceof ArrayBuffer){var t=o.buffer;if(o.byteLength!==t.byteLength){var l=new Uint8Array(o.byteLength);l.set(new Uint8Array(t,o.byteOffset,o.byteLength)),t=l.buffer}r[e]=t}}}function BlobBuilderConstructor(r,e){e=e||{};var o=new BlobBuilder;mapArrayBufferViews(r);for(var t=0;t<r.length;t++)o.append(r[t]);return e.type?o.getBlob(e.type):o.getBlob()}function BlobConstructor(r,e){return mapArrayBufferViews(r),new Blob(r,e||{})}var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder,blobSupported=function(){try{var r=new Blob(["hi"]);return 2===r.size}catch(r){return!1}}(),blobSupportsArrayBufferView=blobSupported&&function(){try{var r=new Blob([new Uint8Array([1,2])]);return 2===r.size}catch(r){return!1}}(),blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;module.exports=function(){return blobSupported?blobSupportsArrayBufferView?global.Blob:BlobConstructor:blobBuilderSupported?BlobBuilderConstructor:void 0}();
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],8:[function(require,module,exports){
!function(e,i,r){"undefined"!=typeof module&&module.exports?module.exports=r():"function"==typeof define&&define.amd?define(i,r):e[i]=r()}(this,"bowser",function(){function e(e){function i(i){var r=e.match(i);return r&&r.length>1&&r[1]||""}function r(i){var r=e.match(i);return r&&r.length>1&&r[2]||""}function s(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}var o,n=i(/(ipod|iphone|ipad)/i).toLowerCase(),a=/like android/i.test(e),d=!a&&/android/i.test(e),m=/nexus\s*[0-6]\s*/i.test(e),v=!m&&/nexus\s*[0-9]+/i.test(e),p=/CrOS/.test(e),l=/silk/i.test(e),c=/sailfish/i.test(e),u=/tizen/i.test(e),f=/(web|hpw)os/i.test(e),h=/windows phone/i.test(e),w=(/SamsungBrowser/i.test(e),!h&&/windows/i.test(e)),b=!n&&!l&&/macintosh/i.test(e),g=!d&&!c&&!u&&!f&&/linux/i.test(e),k=i(/edge\/(\d+(\.\d+)?)/i),y=i(/version\/(\d+(\.\d+)?)/i),x=/tablet/i.test(e),S=!x&&/[^-]mobi/i.test(e),B=/xbox/i.test(e);/opera/i.test(e)?o={name:"Opera",opera:t,version:y||i(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(e)?o={name:"Opera",opera:t,version:i(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||y}:/SamsungBrowser/i.test(e)?o={name:"Samsung Internet for Android",samsungBrowser:t,version:y||i(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(e)?o={name:"Opera Coast",coast:t,version:y||i(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?o={name:"Yandex Browser",yandexbrowser:t,version:y||i(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?o={name:"UC Browser",ucbrowser:t,version:i(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?o={name:"Maxthon",maxthon:t,version:i(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?o={name:"Epiphany",epiphany:t,version:i(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?o={name:"Puffin",puffin:t,version:i(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?o={name:"Sleipnir",sleipnir:t,version:i(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?o={name:"K-Meleon",kMeleon:t,version:i(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:h?(o={name:"Windows Phone",windowsphone:t},k?(o.msedge=t,o.version=k):(o.msie=t,o.version=i(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?o={name:"Internet Explorer",msie:t,version:i(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:p?o={name:"Chrome",chromeos:t,chromeBook:t,chrome:t,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(e)?o={name:"Microsoft Edge",msedge:t,version:k}:/vivaldi/i.test(e)?o={name:"Vivaldi",vivaldi:t,version:i(/vivaldi\/(\d+(\.\d+)?)/i)||y}:c?o={name:"Sailfish",sailfish:t,version:i(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?o={name:"SeaMonkey",seamonkey:t,version:i(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(o={name:"Firefox",firefox:t,version:i(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(o.firefoxos=t)):l?o={name:"Amazon Silk",silk:t,version:i(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?o={name:"PhantomJS",phantom:t,version:i(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?o={name:"SlimerJS",slimer:t,version:i(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?o={name:"BlackBerry",blackberry:t,version:y||i(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(o={name:"WebOS",webos:t,version:y||i(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(o.touchpad=t)):/bada/i.test(e)?o={name:"Bada",bada:t,version:i(/dolfin\/(\d+(\.\d+)?)/i)}:u?o={name:"Tizen",tizen:t,version:i(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||y}:/qupzilla/i.test(e)?o={name:"QupZilla",qupzilla:t,version:i(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||y}:/chromium/i.test(e)?o={name:"Chromium",chromium:t,version:i(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||y}:/chrome|crios|crmo/i.test(e)?o={name:"Chrome",chrome:t,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:d?o={name:"Android",version:y}:/safari|applewebkit/i.test(e)?(o={name:"Safari",safari:t},y&&(o.version=y)):n?(o={name:"iphone"==n?"iPhone":"ipad"==n?"iPad":"iPod"},y&&(o.version=y)):o=/googlebot/i.test(e)?{name:"Googlebot",googlebot:t,version:i(/googlebot\/(\d+(\.\d+))/i)||y}:{name:i(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(o.name=o.name||"Blink",o.blink=t):(o.name=o.name||"Webkit",o.webkit=t),!o.version&&y&&(o.version=y)):!o.opera&&/gecko\//i.test(e)&&(o.name=o.name||"Gecko",o.gecko=t,o.version=o.version||i(/gecko\/(\d+(\.\d+)?)/i)),o.windowsphone||o.msedge||!d&&!o.silk?o.windowsphone||o.msedge||!n?b?o.mac=t:B?o.xbox=t:w?o.windows=t:g&&(o.linux=t):(o[n]=t,o.ios=t):o.android=t;var T="";o.windows?T=s(i(/Windows ((NT|XP)( \d\d?.\d)?)/i)):o.windowsphone?T=i(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):o.mac?(T=i(/Mac OS X (\d+([_\.\s]\d+)*)/i),T=T.replace(/[_\s]/g,".")):n?(T=i(/os (\d+([_\s]\d+)*) like mac os x/i),T=T.replace(/[_\s]/g,".")):d?T=i(/android[ \/-](\d+(\.\d+)*)/i):o.webos?T=i(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?T=i(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?T=i(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(T=i(/tizen[\/\s](\d+(\.\d+)*)/i)),T&&(o.osversion=T);var N=!o.windows&&T.split(".")[0];return x||v||"ipad"==n||d&&(3==N||N>=4&&!S)||o.silk?o.tablet=t:(S||"iphone"==n||"ipod"==n||d||m||o.blackberry||o.webos||o.bada)&&(o.mobile=t),o.msedge||o.msie&&o.version>=10||o.yandexbrowser&&o.version>=15||o.vivaldi&&o.version>=1||o.chrome&&o.version>=20||o.samsungBrowser&&o.version>=4||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1||o.chromium&&o.version>=20?o.a=t:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6||o.chromium&&o.version<20?o.c=t:o.x=t,o}function i(e){return e.split(".").length}function r(e,i){var r,s=[];if(Array.prototype.map)return Array.prototype.map.call(e,i);for(r=0;r<e.length;r++)s.push(i(e[r]));return s}function s(e){for(var s=Math.max(i(e[0]),i(e[1])),o=r(e,function(e){var o=s-i(e);return e+=new Array(o+1).join(".0"),r(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--s>=0;){if(o[0][s]>o[1][s])return 1;if(o[0][s]!==o[1][s])return-1;if(0===s)return 0}}function o(i,r,o){var n=a;"string"==typeof r&&(o=r,r=void 0),void 0===r&&(r=!1),o&&(n=e(o));var t=""+n.version;for(var d in i)if(i.hasOwnProperty(d)&&n[d]){if("string"!=typeof i[d])throw new Error("Browser version in the minVersion map should be a string: "+d+": "+String(i));return s([t,i[d]])<0}return r}function n(e,i,r){return!o(e,i,r)}var t=!0,a=e("undefined"!=typeof navigator?navigator.userAgent||"":"");return a.test=function(e){for(var i=0;i<e.length;++i){var r=e[i];if("string"==typeof r&&r in a)return!0}return!1},a.isUnsupportedBrowser=o,a.compareVersions=s,a.check=n,a._detect=e,a});
},{}],9:[function(require,module,exports){

},{}],10:[function(require,module,exports){
var slice=[].slice;module.exports=function(n,r){if("string"==typeof r&&(r=n[r]),"function"!=typeof r)throw new Error("bind() requires a function");var e=slice.call(arguments,2);return function(){return r.apply(n,e.concat(slice.call(arguments)))}};
},{}],11:[function(require,module,exports){
function Emitter(t){if(t)return mixin(t)}function mixin(t){for(var e in Emitter.prototype)t[e]=Emitter.prototype[e];return t}"undefined"!=typeof module&&(module.exports=Emitter),Emitter.prototype.on=Emitter.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},Emitter.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,s=0;s<i.length;s++)if(r=i[s],r===e||r.fn===e){i.splice(s,1);break}return this},Emitter.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks["$"+t];if(i){i=i.slice(0);for(var r=0,s=i.length;r<s;++r)i[r].apply(this,e)}return this},Emitter.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},Emitter.prototype.hasListeners=function(t){return!!this.listeners(t).length};
},{}],12:[function(require,module,exports){
module.exports=function(o,t){var p=function(){};p.prototype=t.prototype,o.prototype=new p,o.prototype.constructor=o};
},{}],13:[function(require,module,exports){
(function (process){
function useColors(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function formatArgs(){var e=arguments,o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+exports.humanize(this.diff),!o)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var t=0,s=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(t++,"%c"===e&&(s=t))}),e.splice(s,0,r),e}function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(e){try{null==e?exports.storage.removeItem("debug"):exports.storage.debug=e}catch(e){}}function load(){try{return exports.storage.debug}catch(e){}if("undefined"!=typeof process&&"env"in process)return process.env.DEBUG}function localstorage(){try{return window.localStorage}catch(e){}}exports=module.exports=require("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},exports.enable(load());
}).call(this,require('_process'))
},{"./debug":14,"_process":37}],14:[function(require,module,exports){
function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(e){function r(){}function o(){var e=o,r=+new Date,s=r-(prevTime||r);e.diff=s,e.prev=prevTime,e.curr=r,prevTime=r,null==e.useColors&&(e.useColors=exports.useColors()),null==e.color&&e.useColors&&(e.color=selectColor());for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];t[0]=exports.coerce(t[0]),"string"!=typeof t[0]&&(t=["%o"].concat(t));var p=0;t[0]=t[0].replace(/%([a-z%])/g,function(r,o){if("%%"===r)return r;p++;var s=exports.formatters[o];if("function"==typeof s){var n=t[p];r=s.call(e,n),t.splice(p,1),p--}return r}),t=exports.formatArgs.apply(e,t);var l=o.log||exports.log||console.log.bind(console);l.apply(e,t)}r.enabled=!1,o.enabled=!0;var s=exports.enabled(e)?o:r;return s.namespace=e,s}function enable(e){exports.save(e);for(var r=(e||"").split(/[\s,]+/),o=r.length,s=0;s<o;s++)r[s]&&(e=r[s].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"),"-"===e[0]?exports.skips.push(new RegExp("^"+e.substr(1)+"$")):exports.names.push(new RegExp("^"+e+"$")))}function disable(){exports.enable("")}function enabled(e){var r,o;for(r=0,o=exports.skips.length;r<o;r++)if(exports.skips[r].test(e))return!1;for(r=0,o=exports.names.length;r<o;r++)if(exports.names[r].test(e))return!0;return!1}function coerce(e){return e instanceof Error?e.stack||e.message:e}exports=module.exports=debug.debug=debug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevColor=0,prevTime;
},{"ms":33}],15:[function(require,module,exports){
module.exports=require("./lib/index");
},{"./lib/index":16}],16:[function(require,module,exports){
module.exports=require("./socket"),module.exports.parser=require("engine.io-parser");
},{"./socket":17,"engine.io-parser":25}],17:[function(require,module,exports){
(function (global){
function Socket(e,t){if(!(this instanceof Socket))return new Socket(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=parseuri(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=parseuri(t.host).host),this.secure=null!=t.secure?t.secure:global.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(global.location?location.hostname:"localhost"),this.port=t.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=parseqs.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized?null:t.rejectUnauthorized,this.forceNode=!!t.forceNode;var r="object"==typeof global&&global;r.global===r&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function clone(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var transports=require("./transports/index"),Emitter=require("component-emitter"),debug=require("debug")("engine.io-client:socket"),index=require("indexof"),parser=require("engine.io-parser"),parseuri=require("parseuri"),parsejson=require("parsejson"),parseqs=require("parseqs");module.exports=Socket,Socket.priorWebsocketSuccess=!1,Emitter(Socket.prototype),Socket.protocol=parser.protocol,Socket.Socket=Socket,Socket.Transport=require("./transport"),Socket.transports=require("./transports/index"),Socket.parser=require("engine.io-parser"),Socket.prototype.createTransport=function(e){debug('creating transport "%s"',e);var t=clone(this.query);t.EIO=parser.protocol,t.transport=e,this.id&&(t.sid=this.id);var r=new transports[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders,forceNode:this.forceNode,localAddress:this.localAddress});return r},Socket.prototype.open=function(){var e;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Socket.prototype.setTransport=function(e){debug("setting transport %s",e.name);var t=this;this.transport&&(debug("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},Socket.prototype.probe=function(e){function t(){if(h.onlyBinaryUpgrades){var t=!this.supportsBinary&&h.transport.supportsBinary;c=c||t}c||(debug('probe transport "%s" opened',e),p.send([{type:"ping",data:"probe"}]),p.once("packet",function(t){if(!c)if("pong"===t.type&&"probe"===t.data){if(debug('probe transport "%s" pong',e),h.upgrading=!0,h.emit("upgrading",p),!p)return;Socket.priorWebsocketSuccess="websocket"===p.name,debug('pausing current transport "%s"',h.transport.name),h.transport.pause(function(){c||"closed"!==h.readyState&&(debug("changing transport and sending upgrade packet"),a(),h.setTransport(p),p.send([{type:"upgrade"}]),h.emit("upgrade",p),p=null,h.upgrading=!1,h.flush())})}else{debug('probe transport "%s" failed',e);var r=new Error("probe error");r.transport=p.name,h.emit("upgradeError",r)}}))}function r(){c||(c=!0,a(),p.close(),p=null)}function s(t){var s=new Error("probe error: "+t);s.transport=p.name,r(),debug('probe transport "%s" failed because of error: %s',e,t),h.emit("upgradeError",s)}function o(){s("transport closed")}function i(){s("socket closed")}function n(e){p&&e.name!==p.name&&(debug('"%s" works - aborting "%s"',e.name,p.name),r())}function a(){p.removeListener("open",t),p.removeListener("error",s),p.removeListener("close",o),h.removeListener("close",i),h.removeListener("upgrading",n)}debug('probing transport "%s"',e);var p=this.createTransport(e,{probe:1}),c=!1,h=this;Socket.priorWebsocketSuccess=!1,p.once("open",t),p.once("error",s),p.once("close",o),this.once("close",i),this.once("upgrading",n),p.open()},Socket.prototype.onOpen=function(){if(debug("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Socket.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(debug('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(parsejson(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else debug('packet received with socket readyState "%s"',this.readyState)},Socket.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Socket.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},Socket.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},Socket.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Socket.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(debug("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Socket.prototype.write=Socket.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},Socket.prototype.sendPacket=function(e,t,r,s){if("function"==typeof t&&(s=t,t=void 0),"function"==typeof r&&(s=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){r=r||{},r.compress=!1!==r.compress;var o={type:e,data:t,options:r};this.emit("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}},Socket.prototype.close=function(){function e(){s.onClose("forced close"),debug("socket closing - telling transport to close"),s.transport.close()}function t(){s.removeListener("upgrade",t),s.removeListener("upgradeError",t),e()}function r(){s.once("upgrade",t),s.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var s=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():e()}):this.upgrading?r():e()}return this},Socket.prototype.onError=function(e){debug("socket error %j",e),Socket.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Socket.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){debug('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},Socket.prototype.filterUpgrades=function(e){for(var t=[],r=0,s=e.length;r<s;r++)~index(this.transports,e[r])&&t.push(e[r]);return t};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./transport":18,"./transports/index":19,"component-emitter":11,"debug":13,"engine.io-parser":25,"indexof":31,"parsejson":34,"parseqs":35,"parseuri":36}],18:[function(require,module,exports){
function Transport(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}var parser=require("engine.io-parser"),Emitter=require("component-emitter");module.exports=Transport,Emitter(Transport.prototype),Transport.prototype.onError=function(t,e){var r=new Error(t);return r.type="TransportError",r.description=e,this.emit("error",r),this},Transport.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},Transport.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},Transport.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},Transport.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Transport.prototype.onData=function(t){var e=parser.decodePacket(t,this.socket.binaryType);this.onPacket(e)},Transport.prototype.onPacket=function(t){this.emit("packet",t)},Transport.prototype.onClose=function(){this.readyState="closed",this.emit("close")};
},{"component-emitter":11,"engine.io-parser":25}],19:[function(require,module,exports){
(function (global){
function polling(e){var o,t=!1,r=!1,n=!1!==e.jsonp;if(global.location){var i="https:"===location.protocol,l=location.port;l||(l=i?443:80),t=e.hostname!==location.hostname||l!==e.port,r=e.secure!==i}if(e.xdomain=t,e.xscheme=r,o=new XMLHttpRequest(e),"open"in o&&!e.forceJSONP)return new XHR(e);if(!n)throw new Error("JSONP disabled");return new JSONP(e)}var XMLHttpRequest=require("xmlhttprequest-ssl"),XHR=require("./polling-xhr"),JSONP=require("./polling-jsonp"),websocket=require("./websocket");exports.polling=polling,exports.websocket=websocket;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./polling-jsonp":20,"./polling-xhr":21,"./websocket":23,"xmlhttprequest-ssl":24}],20:[function(require,module,exports){
(function (global){
function empty(){}function JSONPPolling(e){Polling.call(this,e),this.query=this.query||{},callbacks||(global.___eio||(global.___eio=[]),callbacks=global.___eio),this.index=callbacks.length;var t=this;callbacks.push(function(e){t.onData(e)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=empty)},!1)}var Polling=require("./polling"),inherit=require("component-inherit");module.exports=JSONPPolling;var rNewline=/\n/g,rEscapedNewline=/\\n/g,callbacks;inherit(JSONPPolling,Polling),JSONPPolling.prototype.supportsBinary=!1,JSONPPolling.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Polling.prototype.doClose.call(this)},JSONPPolling.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var i=document.getElementsByTagName("script")[0];i?i.parentNode.insertBefore(t,i):(document.head||document.body).appendChild(t),this.script=t;var r="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},JSONPPolling.prototype.doWrite=function(e,t){function i(){r(),t()}function r(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(e){o.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';n=document.createElement(e)}catch(e){n=document.createElement("iframe"),n.name=o.iframeId,n.src="javascript:0"}n.id=o.iframeId,o.form.appendChild(n),o.iframe=n}var o=this;if(!this.form){var n,a=document.createElement("form"),l=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=s,a.method="POST",a.setAttribute("accept-charset","utf-8"),l.name="d",a.appendChild(l),document.body.appendChild(a),this.form=a,this.area=l}this.form.action=this.uri(),r(),e=e.replace(rEscapedNewline,"\\\n"),this.area.value=e.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===o.iframe.readyState&&i()}:this.iframe.onload=i};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./polling":22,"component-inherit":12}],21:[function(require,module,exports){
(function (global){
function empty(){}function XHR(t){if(Polling.call(this,t),this.requestTimeout=t.requestTimeout,global.location){var e="https:"===location.protocol,s=location.port;s||(s=e?443:80),this.xd=t.hostname!==global.location.hostname||s!==t.port,this.xs=t.secure!==e}else this.extraHeaders=t.extraHeaders}function Request(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function unloadHandler(){for(var t in Request.requests)Request.requests.hasOwnProperty(t)&&Request.requests[t].abort()}var XMLHttpRequest=require("xmlhttprequest-ssl"),Polling=require("./polling"),Emitter=require("component-emitter"),inherit=require("component-inherit"),debug=require("debug")("engine.io-client:polling-xhr");module.exports=XHR,module.exports.Request=Request,inherit(XHR,Polling),XHR.prototype.supportsBinary=!0,XHR.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new Request(t)},XHR.prototype.doWrite=function(t,e){var s="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:s}),i=this;r.on("success",e),r.on("error",function(t){i.onError("xhr post error",t)}),this.sendXhr=r},XHR.prototype.doPoll=function(){debug("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},Emitter(Request.prototype),Request.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new XMLHttpRequest(t),s=this;try{debug("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders){e.setDisableHeaderCheck(!0);for(var r in this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}}catch(t){}if(this.supportsBinary&&(e.responseType="arraybuffer"),"POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=!0),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){s.onLoad()},e.onerror=function(){s.onError(e.responseText)}):e.onreadystatechange=function(){4===e.readyState&&(200===e.status||1223===e.status?s.onLoad():setTimeout(function(){s.onError(e.status)},0))},debug("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout(function(){s.onError(t)},0)}global.document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)},Request.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Request.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},Request.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},Request.prototype.cleanup=function(t){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=empty:this.xhr.onreadystatechange=empty,t)try{this.xhr.abort()}catch(t){}global.document&&delete Request.requests[this.index],this.xhr=null}},Request.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(t){}if("application/octet-stream"===e)t=this.xhr.response||this.xhr.responseText;else if(this.supportsBinary)try{t=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){for(var s=new Uint8Array(this.xhr.response),r=[],i=0,o=s.length;i<o;i++)r.push(s[i]);t=String.fromCharCode.apply(null,r)}else t=this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},Request.prototype.hasXDR=function(){return"undefined"!=typeof global.XDomainRequest&&!this.xs&&this.enablesXDR},Request.prototype.abort=function(){this.cleanup()},Request.requestsCount=0,Request.requests={},global.document&&(global.attachEvent?global.attachEvent("onunload",unloadHandler):global.addEventListener&&global.addEventListener("beforeunload",unloadHandler,!1));
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./polling":22,"component-emitter":11,"component-inherit":12,"debug":13,"xmlhttprequest-ssl":24}],22:[function(require,module,exports){
function Polling(t){var e=t&&t.forceBase64;hasXHR2&&!e||(this.supportsBinary=!1),Transport.call(this,t)}var Transport=require("../transport"),parseqs=require("parseqs"),parser=require("engine.io-parser"),inherit=require("component-inherit"),yeast=require("yeast"),debug=require("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var t=require("xmlhttprequest-ssl"),e=new t({xdomain:!1});return null!=e.responseType}();inherit(Polling,Transport),Polling.prototype.name="polling",Polling.prototype.doOpen=function(){this.poll()},Polling.prototype.pause=function(t){function e(){debug("paused"),i.readyState="paused",t()}var i=this;if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(debug("we are currently polling - waiting to pause"),o++,this.once("pollComplete",function(){debug("pre-pause polling complete"),--o||e()})),this.writable||(debug("we are currently writing - waiting to pause"),o++,this.once("drain",function(){debug("pre-pause writing complete"),--o||e()}))}else e()},Polling.prototype.poll=function(){debug("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Polling.prototype.onData=function(t){var e=this;debug("polling got data %s",t);var i=function(t,i,o){return"opening"===e.readyState&&e.onOpen(),"close"===t.type?(e.onClose(),!1):void e.onPacket(t)};parser.decodePayload(t,this.socket.binaryType,i),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():debug('ignoring poll - transport state "%s"',this.readyState))},Polling.prototype.doClose=function(){function t(){debug("writing close packet"),e.write([{type:"close"}])}var e=this;"open"===this.readyState?(debug("transport open - closing"),t()):(debug("transport not open - deferring close"),this.once("open",t))},Polling.prototype.write=function(t){var e=this;this.writable=!1;var i=function(){e.writable=!0,e.emit("drain")};parser.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,i)})},Polling.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",i="";!1!==this.timestampRequests&&(t[this.timestampParam]=yeast()),this.supportsBinary||t.sid||(t.b64=1),t=parseqs.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(i=":"+this.port),t.length&&(t="?"+t);var o=this.hostname.indexOf(":")!==-1;return e+"://"+(o?"["+this.hostname+"]":this.hostname)+i+this.path+t};
},{"../transport":18,"component-inherit":12,"debug":13,"engine.io-parser":25,"parseqs":35,"xmlhttprequest-ssl":24,"yeast":71}],23:[function(require,module,exports){
(function (global){
function WS(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=BrowserWebSocket&&!e.forceNode,this.usingBrowserWebSocket||(WebSocket=NodeWebSocket),Transport.call(this,e)}var Transport=require("../transport"),parser=require("engine.io-parser"),parseqs=require("parseqs"),inherit=require("component-inherit"),yeast=require("yeast"),debug=require("debug")("engine.io-client:websocket"),BrowserWebSocket=global.WebSocket||global.MozWebSocket,NodeWebSocket;if("undefined"==typeof window)try{NodeWebSocket=require("ws")}catch(e){}var WebSocket=BrowserWebSocket;WebSocket||"undefined"!=typeof window||(WebSocket=NodeWebSocket),module.exports=WS,inherit(WS,Transport),WS.prototype.name="websocket",WS.prototype.supportsBinary=!0,WS.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=void 0,s={agent:this.agent,perMessageDeflate:this.perMessageDeflate};s.pfx=this.pfx,s.key=this.key,s.passphrase=this.passphrase,s.cert=this.cert,s.ca=this.ca,s.ciphers=this.ciphers,s.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(s.headers=this.extraHeaders),this.localAddress&&(s.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?new WebSocket(e):new WebSocket(e,t,s)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},WS.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},WS.prototype.write=function(e){function t(){s.emit("flush"),setTimeout(function(){s.writable=!0,s.emit("drain")},0)}var s=this;this.writable=!1;for(var r=e.length,o=0,i=r;o<i;o++)!function(e){parser.encodePacket(e,s.supportsBinary,function(o){if(!s.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),s.perMessageDeflate){var n="string"==typeof o?global.Buffer.byteLength(o):o.length;n<s.perMessageDeflate.threshold&&(i.compress=!1)}}try{s.usingBrowserWebSocket?s.ws.send(o):s.ws.send(o,i)}catch(e){debug("websocket closed before onclose event")}--r||t()})}(e[o])},WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)},WS.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},WS.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",s="";this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(s=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=yeast()),this.supportsBinary||(e.b64=1),e=parseqs.encode(e),e.length&&(e="?"+e);var r=this.hostname.indexOf(":")!==-1;return t+"://"+(r?"["+this.hostname+"]":this.hostname)+s+this.path+e},WS.prototype.check=function(){return!(!WebSocket||"__initialize"in WebSocket&&this.name===WS.prototype.name)};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../transport":18,"component-inherit":12,"debug":13,"engine.io-parser":25,"parseqs":35,"ws":9,"yeast":71}],24:[function(require,module,exports){
(function (global){
var hasCORS=require("has-cors");module.exports=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||hasCORS))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(global[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"has-cors":30}],25:[function(require,module,exports){
(function (global){
function encodeBase64Object(e,r){var t="b"+exports.packets[e.type]+e.data.data;return r(t)}function encodeArrayBuffer(e,r,t){if(!r)return exports.encodeBase64Packet(e,t);var n=e.data,a=new Uint8Array(n),o=new Uint8Array(1+n.byteLength);o[0]=packets[e.type];for(var f=0;f<a.length;f++)o[f+1]=a[f];return t(o.buffer)}function encodeBlobAsArrayBuffer(e,r,t){if(!r)return exports.encodeBase64Packet(e,t);var n=new FileReader;return n.onload=function(){e.data=n.result,exports.encodePacket(e,r,!0,t)},n.readAsArrayBuffer(e.data)}function encodeBlob(e,r,t){if(!r)return exports.encodeBase64Packet(e,t);if(dontSendBlobs)return encodeBlobAsArrayBuffer(e,r,t);var n=new Uint8Array(1);n[0]=packets[e.type];var a=new Blob([n.buffer,e.data]);return t(a)}function tryDecode(e){try{e=utf8.decode(e)}catch(e){return!1}return e}function map(e,r,t){for(var n=new Array(e.length),a=after(e.length,t),o=function(e,t,a){r(t,function(r,t){n[e]=t,a(r,n)})},f=0;f<e.length;f++)o(f,e[f],a)}var keys=require("./keys"),hasBinary=require("has-binary"),sliceBuffer=require("arraybuffer.slice"),after=require("after"),utf8=require("wtf-8"),base64encoder;global&&global.ArrayBuffer&&(base64encoder=require("base64-arraybuffer"));var isAndroid="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),isPhantomJS="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},packetslist=keys(packets),err={type:"error",data:"parser error"},Blob=require("blob");exports.encodePacket=function(e,r,t,n){"function"==typeof r&&(n=r,r=!1),"function"==typeof t&&(n=t,t=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if(global.ArrayBuffer&&a instanceof ArrayBuffer)return encodeArrayBuffer(e,r,n);if(Blob&&a instanceof global.Blob)return encodeBlob(e,r,n);if(a&&a.base64)return encodeBase64Object(e,n);var o=packets[e.type];return void 0!==e.data&&(o+=t?utf8.encode(String(e.data)):String(e.data)),n(""+o)},exports.encodeBase64Packet=function(e,r){var t="b"+exports.packets[e.type];if(Blob&&e.data instanceof global.Blob){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];r(t+e)},n.readAsDataURL(e.data)}var a;try{a=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(r){for(var o=new Uint8Array(e.data),f=new Array(o.length),i=0;i<o.length;i++)f[i]=o[i];a=String.fromCharCode.apply(null,f)}return t+=global.btoa(a),r(t)},exports.decodePacket=function(e,r,t){if(void 0===e)return err;if("string"==typeof e){if("b"==e.charAt(0))return exports.decodeBase64Packet(e.substr(1),r);if(t&&(e=tryDecode(e),e===!1))return err;var n=e.charAt(0);return Number(n)==n&&packetslist[n]?e.length>1?{type:packetslist[n],data:e.substring(1)}:{type:packetslist[n]}:err}var a=new Uint8Array(e),n=a[0],o=sliceBuffer(e,1);return Blob&&"blob"===r&&(o=new Blob([o])),{type:packetslist[n],data:o}},exports.decodeBase64Packet=function(e,r){var t=packetslist[e.charAt(0)];if(!base64encoder)return{type:t,data:{base64:!0,data:e.substr(1)}};var n=base64encoder.decode(e.substr(1));return"blob"===r&&Blob&&(n=new Blob([n])),{type:t,data:n}},exports.encodePayload=function(e,r,t){function n(e){return e.length+":"+e}function a(e,t){exports.encodePacket(e,!!o&&r,!0,function(e){t(null,n(e))})}"function"==typeof r&&(t=r,r=null);var o=hasBinary(e);return r&&o?Blob&&!dontSendBlobs?exports.encodePayloadAsBlob(e,t):exports.encodePayloadAsArrayBuffer(e,t):e.length?void map(e,a,function(e,r){return t(r.join(""))}):t("0:")},exports.decodePayload=function(e,r,t){if("string"!=typeof e)return exports.decodePayloadAsBinary(e,r,t);"function"==typeof r&&(t=r,r=null);var n;if(""==e)return t(err,0,1);for(var a,o,f="",i=0,u=e.length;i<u;i++){var c=e.charAt(i);if(":"!=c)f+=c;else{if(""==f||f!=(a=Number(f)))return t(err,0,1);if(o=e.substr(i+1,a),f!=o.length)return t(err,0,1);if(o.length){if(n=exports.decodePacket(o,r,!0),err.type==n.type&&err.data==n.data)return t(err,0,1);var s=t(n,i+a,u);if(!1===s)return}i+=a,f=""}}return""!=f?t(err,0,1):void 0},exports.encodePayloadAsArrayBuffer=function(e,r){function t(e,r){exports.encodePacket(e,!0,!0,function(e){return r(null,e)})}return e.length?void map(e,t,function(e,t){var n=t.reduce(function(e,r){var t;return t="string"==typeof r?r.length:r.byteLength,e+t.toString().length+t+2},0),a=new Uint8Array(n),o=0;return t.forEach(function(e){var r="string"==typeof e,t=e;if(r){for(var n=new Uint8Array(e.length),f=0;f<e.length;f++)n[f]=e.charCodeAt(f);t=n.buffer}r?a[o++]=0:a[o++]=1;for(var i=t.byteLength.toString(),f=0;f<i.length;f++)a[o++]=parseInt(i[f]);a[o++]=255;for(var n=new Uint8Array(t),f=0;f<n.length;f++)a[o++]=n[f]}),r(a.buffer)}):r(new ArrayBuffer(0))},exports.encodePayloadAsBlob=function(e,r){function t(e,r){exports.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);e=n.buffer,t[0]=0}for(var o=e instanceof ArrayBuffer?e.byteLength:e.size,f=o.toString(),i=new Uint8Array(f.length+1),a=0;a<f.length;a++)i[a]=parseInt(f[a]);if(i[f.length]=255,Blob){var u=new Blob([t.buffer,i.buffer,e]);r(null,u)}})}map(e,t,function(e,t){return r(new Blob(t))})},exports.decodePayloadAsBinary=function(e,r,t){"function"==typeof r&&(t=r,r=null);for(var n=e,a=[],o=!1;n.byteLength>0;){for(var f=new Uint8Array(n),i=0===f[0],u="",c=1;255!=f[c];c++){if(u.length>310){o=!0;break}u+=f[c]}if(o)return t(err,0,1);n=sliceBuffer(n,2+u.length),u=parseInt(u);var s=sliceBuffer(n,0,u);if(i)try{s=String.fromCharCode.apply(null,new Uint8Array(s))}catch(e){var l=new Uint8Array(s);s="";for(var c=0;c<l.length;c++)s+=String.fromCharCode(l[c])}a.push(s),n=sliceBuffer(n,u)}var d=a.length;a.forEach(function(e,n){t(exports.decodePacket(e,r,!0),n,d)})};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./keys":26,"after":1,"arraybuffer.slice":2,"base64-arraybuffer":6,"blob":7,"has-binary":28,"wtf-8":70}],26:[function(require,module,exports){
module.exports=Object.keys||function(r){var e=[],t=Object.prototype.hasOwnProperty;for(var o in r)t.call(r,o)&&e.push(o);return e};
},{}],27:[function(require,module,exports){
!function(e){function t(){this._events={},this._conf&&s.call(this,this._conf)}function s(t){t?(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),this._events.maxListeners=t.maxListeners!==e?t.maxListeners:o,t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),t.verboseMemoryLeak&&(this.verboseMemoryLeak=t.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._events.maxListeners=o}function i(e,t){var s="(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.";this.verboseMemoryLeak?(s+=" Event name: %s.",console.error(s,e,t)):console.error(s,e),console.trace&&console.trace()}function n(e){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,s.call(this,e)}function r(e,t,s,i){if(!s)return[];var n,l,h,o,a,c,f,p=[],u=t.length,_=t[i],v=t[i+1];if(i===u&&s._listeners){if("function"==typeof s._listeners)return e&&e.push(s._listeners),[s];for(n=0,l=s._listeners.length;n<l;n++)e&&e.push(s._listeners[n]);return[s]}if("*"===_||"**"===_||s[_]){if("*"===_){for(h in s)"_listeners"!==h&&s.hasOwnProperty(h)&&(p=p.concat(r(e,t,s[h],i+1)));return p}if("**"===_){f=i+1===u||i+2===u&&"*"===v,f&&s._listeners&&(p=p.concat(r(e,t,s,u)));for(h in s)"_listeners"!==h&&s.hasOwnProperty(h)&&("*"===h||"**"===h?(s[h]._listeners&&!f&&(p=p.concat(r(e,t,s[h],u))),p=p.concat(r(e,t,s[h],i))):p=h===v?p.concat(r(e,t,s[h],i+2)):p.concat(r(e,t,s[h],i)));return p}p=p.concat(r(e,t,s[_],i+1))}if(o=s["*"],o&&r(e,t,o,i+1),a=s["**"])if(i<u){a._listeners&&r(e,t,a,u);for(h in a)"_listeners"!==h&&a.hasOwnProperty(h)&&(h===v?r(e,t,a[h],i+2):h===_?r(e,t,a[h],i+1):(c={},c[h]=a[h],r(e,t,{"**":c},i+1)))}else a._listeners?r(e,t,a,u):a["*"]&&a["*"]._listeners&&r(e,t,a["*"],u);return p}function l(t,s){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var n=0,r=t.length;n+1<r;n++)if("**"===t[n]&&"**"===t[n+1])return;for(var l=this.listenerTree,h=t.shift();h!==e;){if(l[h]||(l[h]={}),l=l[h],0===t.length)return l._listeners?("function"==typeof l._listeners&&(l._listeners=[l._listeners]),l._listeners.push(s),!l._listeners.warned&&this._events.maxListeners>0&&l._listeners.length>this._events.maxListeners&&(l._listeners.warned=!0,i.call(this,l._listeners.length,h))):l._listeners=s,!0;h=t.shift()}return!0}var h=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=10;n.EventEmitter2=n,n.prototype.delimiter=".",n.prototype.setMaxListeners=function(s){s!==e&&(this._events||t.call(this),this._events.maxListeners=s,this._conf||(this._conf={}),this._conf.maxListeners=s)},n.prototype.event="",n.prototype.once=function(e,t){return this.many(e,1,t),this},n.prototype.many=function(e,t,s){function i(){0===--t&&n.off(e,i),s.apply(this,arguments)}var n=this;if("function"!=typeof s)throw new Error("many only accepts instances of Function");return i._origin=s,this.on(e,i),n},n.prototype.emit=function(){this._events||t.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;var s,i,n,l,h,o=arguments.length;if(this._all&&this._all.length){if(h=this._all.slice(),o>3)for(s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];for(n=0,i=h.length;n<i;n++)switch(this.event=e,o){case 1:h[n].call(this,e);break;case 2:h[n].call(this,e,arguments[1]);break;case 3:h[n].call(this,e,arguments[1],arguments[2]);break;default:h[n].apply(this,s)}}if(this.wildcard){h=[];var a="string"==typeof e?e.split(this.delimiter):e.slice();r.call(this,h,a,this.listenerTree,0)}else{if(h=this._events[e],"function"==typeof h){switch(this.event=e,o){case 1:h.call(this);break;case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:for(s=new Array(o-1),l=1;l<o;l++)s[l-1]=arguments[l];h.apply(this,s)}return!0}h&&(h=h.slice())}if(h&&h.length){if(o>3)for(s=new Array(o-1),l=1;l<o;l++)s[l-1]=arguments[l];for(n=0,i=h.length;n<i;n++)switch(this.event=e,o){case 1:h[n].call(this);break;case 2:h[n].call(this,arguments[1]);break;case 3:h[n].call(this,arguments[1],arguments[2]);break;default:h[n].apply(this,s)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},n.prototype.emitAsync=function(){this._events||t.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var s,i,n,l,h,o=[],a=arguments.length;if(this._all){if(a>3)for(s=new Array(a),l=1;l<a;l++)s[l]=arguments[l];for(n=0,i=this._all.length;n<i;n++)switch(this.event=e,a){case 1:o.push(this._all[n].call(this,e));break;case 2:o.push(this._all[n].call(this,e,arguments[1]));break;case 3:o.push(this._all[n].call(this,e,arguments[1],arguments[2]));break;default:o.push(this._all[n].apply(this,s))}}if(this.wildcard){h=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();r.call(this,h,c,this.listenerTree,0)}else h=this._events[e];if("function"==typeof h)switch(this.event=e,a){case 1:o.push(h.call(this));break;case 2:o.push(h.call(this,arguments[1]));break;case 3:o.push(h.call(this,arguments[1],arguments[2]));break;default:for(s=new Array(a-1),l=1;l<a;l++)s[l-1]=arguments[l];o.push(h.apply(this,s))}else if(h&&h.length){if(a>3)for(s=new Array(a-1),l=1;l<a;l++)s[l-1]=arguments[l];for(n=0,i=h.length;n<i;n++)switch(this.event=e,a){case 1:o.push(h[n].call(this));break;case 2:o.push(h[n].call(this,arguments[1]));break;case 3:o.push(h[n].call(this,arguments[1],arguments[2]));break;default:o.push(h[n].apply(this,s))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(o)},n.prototype.on=function(e,s){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof s)throw new Error("on only accepts instances of Function");return this._events||t.call(this),this.emit("newListener",e,s),this.wildcard?(l.call(this,e,s),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),this._events[e].push(s),!this._events[e].warned&&this._events.maxListeners>0&&this._events[e].length>this._events.maxListeners&&(this._events[e].warned=!0,i.call(this,this._events[e].length,e))):this._events[e]=s,this)},n.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},n.prototype.addListener=n.prototype.on,n.prototype.off=function(t,s){function i(t){if(t!==e){var s=Object.keys(t);for(var n in s){var r=s[n],l=t[r];l instanceof Function||"object"!=typeof l||null===l||(Object.keys(l).length>0&&i(t[r]),0===Object.keys(l).length&&delete t[r])}}}if("function"!=typeof s)throw new Error("removeListener only takes instances of Function");var n,l=[];if(this.wildcard){var o="string"==typeof t?t.split(this.delimiter):t.slice();l=r.call(this,null,o,this.listenerTree,0)}else{if(!this._events[t])return this;n=this._events[t],l.push({_listeners:n})}for(var a=0;a<l.length;a++){var c=l[a];if(n=c._listeners,h(n)){for(var f=-1,p=0,u=n.length;p<u;p++)if(n[p]===s||n[p].listener&&n[p].listener===s||n[p]._origin&&n[p]._origin===s){f=p;break}if(f<0)continue;return this.wildcard?c._listeners.splice(f,1):this._events[t].splice(f,1),0===n.length&&(this.wildcard?delete c._listeners:delete this._events[t]),this.emit("removeListener",t,s),this}(n===s||n.listener&&n.listener===s||n._origin&&n._origin===s)&&(this.wildcard?delete c._listeners:delete this._events[t],this.emit("removeListener",t,s))}return i(this.listenerTree),this},n.prototype.offAny=function(e){var t,s=0,i=0;if(e&&this._all&&this._all.length>0){for(t=this._all,s=0,i=t.length;s<i;s++)if(e===t[s])return t.splice(s,1),this.emit("removeListenerAny",e),this}else{for(t=this._all,s=0,i=t.length;s<i;s++)this.emit("removeListenerAny",t[s]);this._all=[]}return this},n.prototype.removeListener=n.prototype.off,n.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||t.call(this),this;if(this.wildcard)for(var s="string"==typeof e?e.split(this.delimiter):e.slice(),i=r.call(this,null,s,this.listenerTree,0),n=0;n<i.length;n++){var l=i[n];l._listeners=null}else this._events&&(this._events[e]=null);return this},n.prototype.listeners=function(e){if(this.wildcard){var s=[],i="string"==typeof e?e.split(this.delimiter):e.slice();return r.call(this,s,i,this.listenerTree,0),s}return this._events||t.call(this),this._events[e]||(this._events[e]=[]),h(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},n.prototype.listenerCount=function(e){return this.listeners(e).length},n.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof exports?module.exports=n:window.EventEmitter2=n}();
},{}],28:[function(require,module,exports){
(function (global){
function hasBinary(r){function e(r){if(!r)return!1;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(r)||global.ArrayBuffer&&r instanceof ArrayBuffer||global.Blob&&r instanceof Blob||global.File&&r instanceof File)return!0;if(isArray(r)){for(var f=0;f<r.length;f++)if(e(r[f]))return!0}else if(r&&"object"==typeof r){r.toJSON&&"function"==typeof r.toJSON&&(r=r.toJSON());for(var o in r)if(Object.prototype.hasOwnProperty.call(r,o)&&e(r[o]))return!0}return!1}return e(r)}var isArray=require("isarray");module.exports=hasBinary;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"isarray":29}],29:[function(require,module,exports){
module.exports=Array.isArray||function(r){return"[object Array]"==Object.prototype.toString.call(r)};
},{}],30:[function(require,module,exports){
try{module.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){module.exports=!1}
},{}],31:[function(require,module,exports){
var indexOf=[].indexOf;module.exports=function(e,n){if(indexOf)return e.indexOf(n);for(var r=0;r<e.length;++r)if(e[r]===n)return r;return-1};
},{}],32:[function(require,module,exports){
(function (global){
(function(){function t(e,n){function c(t){if(c[t]!==d)return c[t];var e;if("bug-string-char-index"==t)e="a"!="a"[0];else if("json"==t)e=c("json-stringify")&&c("json-parse");else{var r,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var l=n.stringify,s="function"==typeof l&&C;if(s){(r=function(){return 1}).toJSON=r;try{s="0"===l(0)&&"0"===l(new i)&&'""'==l(new a)&&l(v)===d&&l(d)===d&&l()===d&&"1"===l(r)&&"[1]"==l([r])&&"[null]"==l([d])&&"null"==l(null)&&"[null,null,null]"==l([d,v,null])&&l({a:[r,!0,!1,null,"\0\b\n\f\r\t"]})==o&&"1"===l(null,r)&&"[\n 1,\n 2\n]"==l([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==l(new f(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==l(new f(864e13))&&'"-000001-01-01T00:00:00.000Z"'==l(new f(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==l(new f(-1))}catch(t){s=!1}}e=s}if("json-parse"==t){var u=n.parse;if("function"==typeof u)try{if(0===u("0")&&!u(!1)){r=u(o);var h=5==r.a.length&&1===r.a[0];if(h){try{h=!u('"\t"')}catch(t){}if(h)try{h=1!==u("01")}catch(t){}if(h)try{h=1!==u("1.")}catch(t){}}}}catch(t){h=!1}e=h}}return c[t]=!!e}e||(e=o.Object()),n||(n=o.Object());var i=e.Number||o.Number,a=e.String||o.String,l=e.Object||o.Object,f=e.Date||o.Date,s=e.SyntaxError||o.SyntaxError,u=e.TypeError||o.TypeError,h=e.Math||o.Math,p=e.JSON||o.JSON;"object"==typeof p&&p&&(n.stringify=p.stringify,n.parse=p.parse);var g,y,d,b=l.prototype,v=b.toString,C=new f(-0xc782b5b800cec);try{C=C.getUTCFullYear()==-109252&&0===C.getUTCMonth()&&1===C.getUTCDate()&&10==C.getUTCHours()&&37==C.getUTCMinutes()&&6==C.getUTCSeconds()&&708==C.getUTCMilliseconds()}catch(t){}if(!c("json")){var j="[object Function]",S="[object Date]",O="[object Number]",w="[object String]",T="[object Array]",A="[object Boolean]",_=c("bug-string-char-index");if(!C)var N=h.floor,U=[0,31,59,90,120,151,181,212,243,273,304,334],J=function(t,e){return U[e]+365*(t-1970)+N((t-1969+(e=+(e>1)))/4)-N((t-1901+e)/100)+N((t-1601+e)/400)};if((g=b.hasOwnProperty)||(g=function(t){var e,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=v?g=function(t){var e=this.__proto__,r=t in(this.__proto__=null,this);return this.__proto__=e,r}:(e=r.constructor,g=function(t){var r=(this.constructor||e).prototype;return t in this&&!(t in r&&this[t]===r[t])}),r=null,g.call(this,t)}),y=function(t,e){var n,o,c,i=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,o=new n;for(c in o)g.call(o,c)&&i++;return n=o=null,i?y=2==i?function(t,e){var r,n={},o=v.call(t)==j;for(r in t)o&&"prototype"==r||g.call(n,r)||!(n[r]=1)||!g.call(t,r)||e(r)}:function(t,e){var r,n,o=v.call(t)==j;for(r in t)o&&"prototype"==r||!g.call(t,r)||(n="constructor"===r)||e(r);(n||g.call(t,r="constructor"))&&e(r)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],y=function(t,e){var n,c,i=v.call(t)==j,a=!i&&"function"!=typeof t.constructor&&r[typeof t.hasOwnProperty]&&t.hasOwnProperty||g;for(n in t)i&&"prototype"==n||!a.call(t,n)||e(n);for(c=o.length;n=o[--c];a.call(t,n)&&e(n));}),y(t,e)},!c("json-stringify")){var x={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},m="000000",M=function(t,e){return(m+(e||0)).slice(-t)},k="\\u00",D=function(t){for(var e='"',r=0,n=t.length,o=!_||n>10,c=o&&(_?t.split(""):t);r<n;r++){var i=t.charCodeAt(r);switch(i){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=x[i];break;default:if(i<32){e+=k+M(2,i.toString(16));break}e+=o?c[r]:t.charAt(r)}}return e+'"'},E=function(t,e,r,n,o,c,i){var a,l,f,s,h,p,b,C,j,_,U,x,m,k,P,Z;try{a=e[t]}catch(t){}if("object"==typeof a&&a)if(l=v.call(a),l!=S||g.call(a,"toJSON"))"function"==typeof a.toJSON&&(l!=O&&l!=w&&l!=T||g.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&a<1/0){if(J){for(h=N(a/864e5),f=N(h/365.2425)+1970-1;J(f+1,0)<=h;f++);for(s=N((h-J(f,0))/30.42);J(f,s+1)<=h;s++);h=1+h-J(f,s),p=(a%864e5+864e5)%864e5,b=N(p/36e5)%24,C=N(p/6e4)%60,j=N(p/1e3)%60,_=p%1e3}else f=a.getUTCFullYear(),s=a.getUTCMonth(),h=a.getUTCDate(),b=a.getUTCHours(),C=a.getUTCMinutes(),j=a.getUTCSeconds(),_=a.getUTCMilliseconds();a=(f<=0||f>=1e4?(f<0?"-":"+")+M(6,f<0?-f:f):M(4,f))+"-"+M(2,s+1)+"-"+M(2,h)+"T"+M(2,b)+":"+M(2,C)+":"+M(2,j)+"."+M(3,_)+"Z"}else a=null;if(r&&(a=r.call(e,t,a)),null===a)return"null";if(l=v.call(a),l==A)return""+a;if(l==O)return a>-1/0&&a<1/0?""+a:"null";if(l==w)return D(""+a);if("object"==typeof a){for(k=i.length;k--;)if(i[k]===a)throw u();if(i.push(a),U=[],P=c,c+=o,l==T){for(m=0,k=a.length;m<k;m++)x=E(m,a,r,n,o,c,i),U.push(x===d?"null":x);Z=U.length?o?"[\n"+c+U.join(",\n"+c)+"\n"+P+"]":"["+U.join(",")+"]":"[]"}else y(n||a,function(t){var e=E(t,a,r,n,o,c,i);e!==d&&U.push(D(t)+":"+(o?" ":"")+e)}),Z=U.length?o?"{\n"+c+U.join(",\n"+c)+"\n"+P+"}":"{"+U.join(",")+"}":"{}";return i.pop(),Z}};n.stringify=function(t,e,n){var o,c,i,a;if(r[typeof e]&&e)if((a=v.call(e))==j)c=e;else if(a==T){i={};for(var l,f=0,s=e.length;f<s;l=e[f++],a=v.call(l),(a==w||a==O)&&(i[l]=1));}if(n)if((a=v.call(n))==O){if((n-=n%1)>0)for(o="",n>10&&(n=10);o.length<n;o+=" ");}else a==w&&(o=n.length<=10?n:n.slice(0,10));return E("",(l={},l[""]=t,l),c,i,o,"",[])}}if(!c("json-parse")){var P,Z,F=a.fromCharCode,$={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},H=function(){throw P=Z=null,s()},I=function(){for(var t,e,r,n,o,c=Z,i=c.length;P<i;)switch(o=c.charCodeAt(P)){case 9:case 10:case 13:case 32:P++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=_?c.charAt(P):c[P],P++,t;case 34:for(t="@",P++;P<i;)if(o=c.charCodeAt(P),o<32)H();else if(92==o)switch(o=c.charCodeAt(++P)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=$[o],P++;break;case 117:for(e=++P,r=P+4;P<r;P++)o=c.charCodeAt(P),o>=48&&o<=57||o>=97&&o<=102||o>=65&&o<=70||H();t+=F("0x"+c.slice(e,P));break;default:H()}else{if(34==o)break;for(o=c.charCodeAt(P),e=P;o>=32&&92!=o&&34!=o;)o=c.charCodeAt(++P);t+=c.slice(e,P)}if(34==c.charCodeAt(P))return P++,t;H();default:if(e=P,45==o&&(n=!0,o=c.charCodeAt(++P)),o>=48&&o<=57){for(48==o&&(o=c.charCodeAt(P+1),o>=48&&o<=57)&&H(),n=!1;P<i&&(o=c.charCodeAt(P),o>=48&&o<=57);P++);if(46==c.charCodeAt(P)){for(r=++P;r<i&&(o=c.charCodeAt(r),o>=48&&o<=57);r++);r==P&&H(),P=r}if(o=c.charCodeAt(P),101==o||69==o){for(o=c.charCodeAt(++P),43!=o&&45!=o||P++,r=P;r<i&&(o=c.charCodeAt(r),o>=48&&o<=57);r++);r==P&&H(),P=r}return+c.slice(e,P)}if(n&&H(),"true"==c.slice(P,P+4))return P+=4,!0;if("false"==c.slice(P,P+5))return P+=5,!1;if("null"==c.slice(P,P+4))return P+=4,null;H()}return"$"},Y=function(t){var e,r;if("$"==t&&H(),"string"==typeof t){if("@"==(_?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=I(),"]"!=t;r||(r=!0))r&&(","==t?(t=I(),"]"==t&&H()):H()),","==t&&H(),e.push(Y(t));return e}if("{"==t){for(e={};t=I(),"}"!=t;r||(r=!0))r&&(","==t?(t=I(),"}"==t&&H()):H()),","!=t&&"string"==typeof t&&"@"==(_?t.charAt(0):t[0])&&":"==I()||H(),e[t.slice(1)]=Y(I());return e}H()}return t},B=function(t,e,r){var n=L(t,e,r);n===d?delete t[e]:t[e]=n},L=function(t,e,r){var n,o=t[e];if("object"==typeof o&&o)if(v.call(o)==T)for(n=o.length;n--;)B(o,n,r);else y(o,function(t){B(o,t,r)});return r.call(t,e,o)};n.parse=function(t,e){var r,n;return P=0,Z=""+t,r=Y(I()),"$"!=I()&&H(),P=Z=null,e&&v.call(e)==j?L((n={},n[""]=r,n),"",e):r}}}return n.runInContext=t,n}var e="function"==typeof define&&define.amd,r={function:!0,object:!0},n=r[typeof exports]&&exports&&!exports.nodeType&&exports,o=r[typeof window]&&window||this,c=n&&r[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!c||c.global!==c&&c.window!==c&&c.self!==c||(o=c),n&&!e)t(o,n);else{var i=o.JSON,a=o.JSON3,l=!1,f=t(o,o.JSON3={noConflict:function(){return l||(l=!0,o.JSON=i,o.JSON3=a,i=a=null),f}});o.JSON={parse:f.parse,stringify:f.stringify}}e&&define(function(){return f})}).call(this);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],33:[function(require,module,exports){
function parse(e){if(e=String(e),!(e.length>1e4)){var r=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(r){var a=parseFloat(r[1]),n=(r[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return a*y;case"days":case"day":case"d":return a*d;case"hours":case"hour":case"hrs":case"hr":case"h":return a*h;case"minutes":case"minute":case"mins":case"min":case"m":return a*m;case"seconds":case"second":case"secs":case"sec":case"s":return a*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}function fmtShort(e){return e>=d?Math.round(e/d)+"d":e>=h?Math.round(e/h)+"h":e>=m?Math.round(e/m)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function fmtLong(e){return plural(e,d,"day")||plural(e,h,"hour")||plural(e,m,"minute")||plural(e,s,"second")||e+" ms"}function plural(s,e,r){if(!(s<e))return s<1.5*e?Math.floor(s/e)+" "+r:Math.ceil(s/e)+" "+r+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(s,e){e=e||{};var r=typeof s;if("string"===r&&s.length>0)return parse(s);if("number"===r&&isNaN(s)===!1)return e.long?fmtLong(s):fmtShort(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};
},{}],34:[function(require,module,exports){
(function (global){
var rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rtrimLeft=/^\s+/,rtrimRight=/\s+$/;module.exports=function(r){return"string"==typeof r&&r?(r=r.replace(rtrimLeft,"").replace(rtrimRight,""),global.JSON&&JSON.parse?JSON.parse(r):rvalidchars.test(r.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))?new Function("return "+r)():void 0):null};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],35:[function(require,module,exports){
exports.encode=function(e){var n="";for(var o in e)e.hasOwnProperty(o)&&(n.length&&(n+="&"),n+=encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return n},exports.decode=function(e){for(var n={},o=e.split("&"),t=0,r=o.length;t<r;t++){var d=o[t].split("=");n[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return n};
},{}],36:[function(require,module,exports){
var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(r){var e=r,t=r.indexOf("["),s=r.indexOf("]");t!=-1&&s!=-1&&(r=r.substring(0,t)+r.substring(t,s).replace(/:/g,";")+r.substring(s,r.length));for(var o=re.exec(r||""),a={},u=14;u--;)a[parts[u]]=o[u]||"";return t!=-1&&s!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a};
},{}],37:[function(require,module,exports){
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var u=1;u<arguments.length;u++)t[u-1]=arguments[u];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],38:[function(require,module,exports){
"use strict";module.exports=require("./lib");
},{"./lib":43}],39:[function(require,module,exports){
"use strict";function noop(){}function getThen(e){try{return e.then}catch(e){return LAST_ERROR=e,IS_ERROR}}function tryCallOne(e,n){try{return e(n)}catch(e){return LAST_ERROR=e,IS_ERROR}}function tryCallTwo(e,n,o){try{e(n,o)}catch(e){return LAST_ERROR=e,IS_ERROR}}function Promise(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._45=0,this._81=0,this._65=null,this._54=null,e!==noop&&doResolve(e,this)}function safeThen(e,n,o){return new e.constructor(function(t,r){var i=new Promise(noop);i.then(t,r),handle(e,new Handler(n,o,i))})}function handle(e,n){for(;3===e._81;)e=e._65;return Promise._10&&Promise._10(e),0===e._81?0===e._45?(e._45=1,void(e._54=n)):1===e._45?(e._45=2,void(e._54=[e._54,n])):void e._54.push(n):void handleResolved(e,n)}function handleResolved(e,n){asap(function(){var o=1===e._81?n.onFulfilled:n.onRejected;if(null===o)return void(1===e._81?resolve(n.promise,e._65):reject(n.promise,e._65));var t=tryCallOne(o,e._65);t===IS_ERROR?reject(n.promise,LAST_ERROR):resolve(n.promise,t)})}function resolve(e,n){if(n===e)return reject(e,new TypeError("A promise cannot be resolved with itself."));if(n&&("object"==typeof n||"function"==typeof n)){var o=getThen(n);if(o===IS_ERROR)return reject(e,LAST_ERROR);if(o===e.then&&n instanceof Promise)return e._81=3,e._65=n,void finale(e);if("function"==typeof o)return void doResolve(o.bind(n),e)}e._81=1,e._65=n,finale(e)}function reject(e,n){e._81=2,e._65=n,Promise._97&&Promise._97(e,n),finale(e)}function finale(e){if(1===e._45&&(handle(e,e._54),e._54=null),2===e._45){for(var n=0;n<e._54.length;n++)handle(e,e._54[n]);e._54=null}}function Handler(e,n,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=o}function doResolve(e,n){var o=!1,t=tryCallTwo(e,function(e){o||(o=!0,resolve(n,e))},function(e){o||(o=!0,reject(n,e))});o||t!==IS_ERROR||(o=!0,reject(n,LAST_ERROR))}var asap=require("asap/raw"),LAST_ERROR=null,IS_ERROR={};module.exports=Promise,Promise._10=null,Promise._97=null,Promise._61=noop,Promise.prototype.then=function(e,n){if(this.constructor!==Promise)return safeThen(this,e,n);var o=new Promise(noop);return handle(this,new Handler(e,n,o)),o};
},{"asap/raw":4}],40:[function(require,module,exports){
"use strict";var Promise=require("./core.js");module.exports=Promise,Promise.prototype.done=function(t,e){var o=arguments.length?this.then.apply(this,arguments):this;o.then(null,function(t){setTimeout(function(){throw t},0)})};
},{"./core.js":39}],41:[function(require,module,exports){
"use strict";function valuePromise(e){var r=new Promise(Promise._61);return r._81=1,r._65=e,r}var Promise=require("./core.js");module.exports=Promise;var TRUE=valuePromise(!0),FALSE=valuePromise(!1),NULL=valuePromise(null),UNDEFINED=valuePromise(void 0),ZERO=valuePromise(0),EMPTYSTRING=valuePromise("");Promise.resolve=function(e){if(e instanceof Promise)return e;if(null===e)return NULL;if(void 0===e)return UNDEFINED;if(e===!0)return TRUE;if(e===!1)return FALSE;if(0===e)return ZERO;if(""===e)return EMPTYSTRING;if("object"==typeof e||"function"==typeof e)try{var r=e.then;if("function"==typeof r)return new Promise(r.bind(e))}catch(e){return new Promise(function(r,n){n(e)})}return valuePromise(e)},Promise.all=function(e){var r=Array.prototype.slice.call(e);return new Promise(function(e,n){function o(i,u){if(u&&("object"==typeof u||"function"==typeof u)){if(u instanceof Promise&&u.then===Promise.prototype.then){for(;3===u._81;)u=u._65;return 1===u._81?o(i,u._65):(2===u._81&&n(u._65),void u.then(function(e){o(i,e)},n))}var f=u.then;if("function"==typeof f){var s=new Promise(f.bind(u));return void s.then(function(e){o(i,e)},n)}}r[i]=u,0===--t&&e(r)}if(0===r.length)return e([]);for(var t=r.length,i=0;i<r.length;i++)o(i,r[i])})},Promise.reject=function(e){return new Promise(function(r,n){n(e)})},Promise.race=function(e){return new Promise(function(r,n){e.forEach(function(e){Promise.resolve(e).then(r,n)})})},Promise.prototype.catch=function(e){return this.then(null,e)};
},{"./core.js":39}],42:[function(require,module,exports){
"use strict";var Promise=require("./core.js");module.exports=Promise,Promise.prototype.finally=function(e){return this.then(function(r){return Promise.resolve(e()).then(function(){return r})},function(r){return Promise.resolve(e()).then(function(){throw r})})};
},{"./core.js":39}],43:[function(require,module,exports){
"use strict";module.exports=require("./core.js"),require("./done.js"),require("./finally.js"),require("./es6-extensions.js"),require("./node-extensions.js"),require("./synchronous.js");
},{"./core.js":39,"./done.js":40,"./es6-extensions.js":41,"./finally.js":42,"./node-extensions.js":44,"./synchronous.js":45}],44:[function(require,module,exports){
"use strict";function denodeifyWithCount(n,e){for(var r=[],t=0;t<e;t++)r.push("a"+t);var o=["return function ("+r.join(",")+") {","var self = this;","return new Promise(function (rs, rj) {","var res = fn.call(",["self"].concat(r).concat([callbackFn]).join(","),");","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],o)(Promise,n)}function denodeifyWithoutCount(n){for(var e=Math.max(n.length-1,3),r=[],t=0;t<e;t++)r.push("a"+t);var o=["return function ("+r.join(",")+") {","var self = this;","var args;","var argLength = arguments.length;","if (arguments.length > "+e+") {","args = new Array(arguments.length + 1);","for (var i = 0; i < arguments.length; i++) {","args[i] = arguments[i];","}","}","return new Promise(function (rs, rj) {","var cb = "+callbackFn+";","var res;","switch (argLength) {",r.concat(["extra"]).map(function(n,e){return"case "+e+":res = fn.call("+["self"].concat(r.slice(0,e)).concat("cb").join(",")+");break;"}).join(""),"default:","args[argLength] = cb;","res = fn.apply(self, args);","}","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],o)(Promise,n)}var Promise=require("./core.js"),asap=require("asap");module.exports=Promise,Promise.denodeify=function(n,e){return"number"==typeof e&&e!==1/0?denodeifyWithCount(n,e):denodeifyWithoutCount(n)};var callbackFn="function (err, res) {if (err) { rj(err); } else { rs(res); }}";Promise.nodeify=function(n){return function(){var e=Array.prototype.slice.call(arguments),r="function"==typeof e[e.length-1]?e.pop():null,t=this;try{return n.apply(this,arguments).nodeify(r,t)}catch(n){if(null===r||"undefined"==typeof r)return new Promise(function(e,r){r(n)});asap(function(){r.call(t,n)})}}},Promise.prototype.nodeify=function(n,e){return"function"!=typeof n?this:void this.then(function(r){asap(function(){n.call(e,null,r)})},function(r){asap(function(){n.call(e,r)})})};
},{"./core.js":39,"asap":3}],45:[function(require,module,exports){
"use strict";var Promise=require("./core.js");module.exports=Promise,Promise.enableSynchronous=function(){Promise.prototype.isPending=function(){return 0==this.getState()},Promise.prototype.isFulfilled=function(){return 1==this.getState()},Promise.prototype.isRejected=function(){return 2==this.getState()},Promise.prototype.getValue=function(){if(3===this._81)return this._65.getValue();if(!this.isFulfilled())throw new Error("Cannot get a value of an unfulfilled promise.");return this._65},Promise.prototype.getReason=function(){if(3===this._81)return this._65.getReason();if(!this.isRejected())throw new Error("Cannot get a rejection reason of a non-rejected promise.");return this._65},Promise.prototype.getState=function(){return 3===this._81?this._65.getState():this._81===-1||this._81===-2?0:this._81}},Promise.disableSynchronous=function(){Promise.prototype.isPending=void 0,Promise.prototype.isFulfilled=void 0,Promise.prototype.isRejected=void 0,Promise.prototype.getValue=void 0,Promise.prototype.getReason=void 0,Promise.prototype.getState=void 0};
},{"./core.js":39}],46:[function(require,module,exports){
"use strict";var SDPUtils={};SDPUtils.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},SDPUtils.localCName=SDPUtils.generateIdentifier(),SDPUtils.splitLines=function(t){return t.trim().split("\n").map(function(t){return t.trim()})},SDPUtils.splitSections=function(t){var r=t.split("\nm=");return r.map(function(t,r){return(r>0?"m="+t:t).trim()+"\r\n"})},SDPUtils.matchPrefix=function(t,r){return SDPUtils.splitLines(t).filter(function(t){return 0===t.indexOf(r)})},SDPUtils.parseCandidate=function(t){var r;r=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" ");for(var e={foundation:r[0],component:r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],port:parseInt(r[5],10),type:r[7]},a=8;a<r.length;a+=2)switch(r[a]){case"raddr":e.relatedAddress=r[a+1];break;case"rport":e.relatedPort=parseInt(r[a+1],10);break;case"tcptype":e.tcpType=r[a+1]}return e},SDPUtils.writeCandidate=function(t){var r=[];r.push(t.foundation),r.push(t.component),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.ip),r.push(t.port);var e=t.type;return r.push("typ"),r.push(e),"host"!==e&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(r.push("tcptype"),r.push(t.tcpType)),"candidate:"+r.join(" ")},SDPUtils.parseRtpMap=function(t){var r=t.substr(9).split(" "),e={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),e.name=r[0],e.clockRate=parseInt(r[1],10),e.numChannels=3===r.length?parseInt(r[2],10):1,e},SDPUtils.writeRtpMap=function(t){var r=t.payloadType;return void 0!==t.preferredPayloadType&&(r=t.preferredPayloadType),"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(1!==t.numChannels?"/"+t.numChannels:"")+"\r\n"},SDPUtils.parseExtmap=function(t){var r=t.substr(9).split(" ");return{id:parseInt(r[0],10),uri:r[1]}},SDPUtils.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+" "+t.uri+"\r\n"},SDPUtils.parseFmtp=function(t){for(var r,e={},a=t.substr(t.indexOf(" ")+1).split(";"),s=0;s<a.length;s++)r=a[s].trim().split("="),e[r[0].trim()]=r[1];return e},SDPUtils.writeFmtp=function(t){var r="",e=t.payloadType;if(void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var a=[];Object.keys(t.parameters).forEach(function(r){a.push(r+"="+t.parameters[r])}),r+="a=fmtp:"+e+" "+a.join(";")+"\r\n"}return r},SDPUtils.parseRtcpFb=function(t){var r=t.substr(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},SDPUtils.writeRtcpFb=function(t){var r="",e=t.payloadType;return void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(t){r+="a=rtcp-fb:"+e+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"}),r},SDPUtils.parseSsrcMedia=function(t){var r=t.indexOf(" "),e={ssrc:parseInt(t.substr(7,r-7),10)},a=t.indexOf(":",r);return a>-1?(e.attribute=t.substr(r+1,a-r-1),e.value=t.substr(a+1)):e.attribute=t.substr(r+1),e},SDPUtils.getDtlsParameters=function(t,r){var e=SDPUtils.splitLines(t);e=e.concat(SDPUtils.splitLines(r));var a=e.filter(function(t){return 0===t.indexOf("a=fingerprint:")})[0].substr(14),s={role:"auto",fingerprints:[{algorithm:a.split(" ")[0],value:a.split(" ")[1]}]};return s},SDPUtils.writeDtlsParameters=function(t,r){var e="a=setup:"+r+"\r\n";return t.fingerprints.forEach(function(t){e+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"}),e},SDPUtils.getIceParameters=function(t,r){var e=SDPUtils.splitLines(t);e=e.concat(SDPUtils.splitLines(r));var a={usernameFragment:e.filter(function(t){return 0===t.indexOf("a=ice-ufrag:")})[0].substr(12),password:e.filter(function(t){return 0===t.indexOf("a=ice-pwd:")})[0].substr(10)};return a},SDPUtils.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},SDPUtils.parseRtpParameters=function(t){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},e=SDPUtils.splitLines(t),a=e[0].split(" "),s=3;s<a.length;s++){var n=a[s],i=SDPUtils.matchPrefix(t,"a=rtpmap:"+n+" ")[0];if(i){var p=SDPUtils.parseRtpMap(i),c=SDPUtils.matchPrefix(t,"a=fmtp:"+n+" ");switch(p.parameters=c.length?SDPUtils.parseFmtp(c[0]):{},p.rtcpFeedback=SDPUtils.matchPrefix(t,"a=rtcp-fb:"+n+" ").map(SDPUtils.parseRtcpFb),r.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(p.name.toUpperCase())}}}return SDPUtils.matchPrefix(t,"a=extmap:").forEach(function(t){r.headerExtensions.push(SDPUtils.parseExtmap(t))}),r},SDPUtils.writeRtpDescription=function(t,r){var e="";return e+="m="+t+" ",e+=r.codecs.length>0?"9":"0",e+=" UDP/TLS/RTP/SAVPF ",e+=r.codecs.map(function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType}).join(" ")+"\r\n",e+="c=IN IP4 0.0.0.0\r\n",e+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach(function(t){e+=SDPUtils.writeRtpMap(t),e+=SDPUtils.writeFmtp(t),e+=SDPUtils.writeRtcpFb(t)}),e+="a=rtcp-mux\r\n",r.headerExtensions.forEach(function(t){e+=SDPUtils.writeExtmap(t)}),e},SDPUtils.parseRtpEncodingParameters=function(t){var r,e=[],a=SDPUtils.parseRtpParameters(t),s=a.fecMechanisms.indexOf("RED")!==-1,n=a.fecMechanisms.indexOf("ULPFEC")!==-1,i=SDPUtils.matchPrefix(t,"a=ssrc:").map(function(t){return SDPUtils.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute}),p=i.length>0&&i[0].ssrc,c=SDPUtils.matchPrefix(t,"a=ssrc-group:FID").map(function(t){var r=t.split(" ");return r.shift(),r.map(function(t){return parseInt(t,10)})});c.length>0&&c[0].length>1&&c[0][0]===p&&(r=c[0][1]),a.codecs.forEach(function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var a={ssrc:p,codecPayloadType:parseInt(t.parameters.apt,10),rtx:{payloadType:t.payloadType,ssrc:r}};e.push(a),s&&(a=JSON.parse(JSON.stringify(a)),a.fec={ssrc:r,mechanism:n?"red+ulpfec":"red"},e.push(a))}}),0===e.length&&p&&e.push({ssrc:p});var o=SDPUtils.matchPrefix(t,"b=");return o.length&&(0===o[0].indexOf("b=TIAS:")?o=parseInt(o[0].substr(7),10):0===o[0].indexOf("b=AS:")&&(o=parseInt(o[0].substr(5),10)),e.forEach(function(t){t.maxBitrate=o})),e},SDPUtils.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},SDPUtils.writeMediaSection=function(t,r,e,a){var s=SDPUtils.writeRtpDescription(t.kind,r);if(s+=SDPUtils.writeIceParameters(t.iceGatherer.getLocalParameters()),s+=SDPUtils.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===e?"actpass":"active"),s+="a=mid:"+t.mid+"\r\n",s+=t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var n="msid:"+a.id+" "+t.rtpSender.track.id+"\r\n";s+="a="+n,s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+n}return s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n"},SDPUtils.getDirection=function(t,r){for(var e=SDPUtils.splitLines(t),a=0;a<e.length;a++)switch(e[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[a].substr(2)}return r?SDPUtils.getDirection(r):"sendrecv"},module.exports=SDPUtils;
},{}],47:[function(require,module,exports){
function lookup(e,r){"object"==typeof e&&(r=e,e=void 0),r=r||{};var o,n=url(e),c=n.source,t=n.id,a=n.path,u=cache[t]&&a in cache[t].nsps,p=r.forceNew||r["force new connection"]||!1===r.multiplex||u;return p?(debug("ignoring socket cache for %s",c),o=Manager(c,r)):(cache[t]||(debug("new io instance for %s",c),cache[t]=Manager(c,r)),o=cache[t]),n.query&&!r.query?r.query=n.query:r&&"object"==typeof r.query&&(r.query=encodeQueryString(r.query)),o.socket(n.path,r)}function encodeQueryString(e){var r=[];for(var o in e)e.hasOwnProperty(o)&&r.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return r.join("&")}var url=require("./url"),parser=require("socket.io-parser"),Manager=require("./manager"),debug=require("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};exports.protocol=parser.protocol,exports.connect=lookup,exports.Manager=require("./manager"),exports.Socket=require("./socket");
},{"./manager":48,"./socket":50,"./url":51,"debug":13,"socket.io-parser":53}],48:[function(require,module,exports){
function Manager(t,e){return this instanceof Manager?(t&&"object"==typeof t&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new parser.Encoder,this.decoder=new parser.Decoder,this.autoConnect=e.autoConnect!==!1,void(this.autoConnect&&this.open())):new Manager(t,e)}var eio=require("engine.io-client"),Socket=require("./socket"),Emitter=require("component-emitter"),parser=require("socket.io-parser"),on=require("./on"),bind=require("component-bind"),debug=require("debug")("socket.io-client:manager"),indexOf=require("indexof"),Backoff=require("backo2"),has=Object.prototype.hasOwnProperty;module.exports=Manager,Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps)has.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},Manager.prototype.updateSocketIds=function(){for(var t in this.nsps)has.call(this.nsps,t)&&(this.nsps[t].id=this.engine.id)},Emitter(Manager.prototype),Manager.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},Manager.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},Manager.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},Manager.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},Manager.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},Manager.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},Manager.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Manager.prototype.open=Manager.prototype.connect=function(t,e){if(debug("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri),this.engine=eio(this.uri,this.opts);var n=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var i=on(n,"open",function(){o.onopen(),t&&t()}),s=on(n,"error",function(e){if(debug("connect_error"),o.cleanup(),o.readyState="closed",o.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else o.maybeReconnectOnOpen()});if(!1!==this._timeout){var r=this._timeout;debug("connect attempt will timeout after %d",r);var c=setTimeout(function(){debug("connect attempt timed out after %d",r),i.destroy(),n.close(),n.emit("error","timeout"),o.emitAll("connect_timeout",r)},r);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(i),this.subs.push(s),this},Manager.prototype.onopen=function(){debug("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(on(t,"data",bind(this,"ondata"))),this.subs.push(on(t,"ping",bind(this,"onping"))),this.subs.push(on(t,"pong",bind(this,"onpong"))),this.subs.push(on(t,"error",bind(this,"onerror"))),this.subs.push(on(t,"close",bind(this,"onclose"))),this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")))},Manager.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Manager.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Manager.prototype.ondata=function(t){this.decoder.add(t)},Manager.prototype.ondecoded=function(t){this.emit("packet",t)},Manager.prototype.onerror=function(t){debug("error",t),this.emitAll("error",t)},Manager.prototype.socket=function(t,e){function n(){~indexOf(i.connecting,o)||i.connecting.push(o)}var o=this.nsps[t];if(!o){o=new Socket(this,t,e),this.nsps[t]=o;var i=this;o.on("connecting",n),o.on("connect",function(){o.id=i.engine.id}),this.autoConnect&&n()}return o},Manager.prototype.destroy=function(t){var e=indexOf(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},Manager.prototype.packet=function(t){debug("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var o=0;o<n.length;o++)e.engine.write(n[o],t.options);e.encoding=!1,e.processPacketQueue()}))},Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},Manager.prototype.cleanup=function(){debug("cleanup");for(var t=this.subs.length,e=0;e<t;e++){var n=this.subs.shift();n.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Manager.prototype.close=Manager.prototype.disconnect=function(){debug("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Manager.prototype.onclose=function(t){debug("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)debug("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();debug("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(debug("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(debug("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(debug("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},Manager.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)};
},{"./on":49,"./socket":50,"backo2":5,"component-bind":10,"component-emitter":11,"debug":13,"engine.io-client":15,"indexof":31,"socket.io-parser":53}],49:[function(require,module,exports){
function on(n,o,e){return n.on(o,e),{destroy:function(){n.removeListener(o,e)}}}module.exports=on;
},{}],50:[function(require,module,exports){
function Socket(t,e,s){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,s&&s.query&&(this.query=s.query),this.io.autoConnect&&this.open()}var parser=require("socket.io-parser"),Emitter=require("component-emitter"),toArray=require("to-array"),on=require("./on"),bind=require("component-bind"),debug=require("debug")("socket.io-client:socket"),hasBin=require("has-binary");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},emit=Emitter.prototype.emit;Emitter(Socket.prototype),Socket.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[on(t,"open",bind(this,"onopen")),on(t,"packet",bind(this,"onpacket")),on(t,"close",bind(this,"onclose"))]}},Socket.prototype.open=Socket.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},Socket.prototype.send=function(){var t=toArray(arguments);return t.unshift("message"),this.emit.apply(this,t),this},Socket.prototype.emit=function(t){if(events.hasOwnProperty(t))return emit.apply(this,arguments),this;var e=toArray(arguments),s=parser.EVENT;hasBin(e)&&(s=parser.BINARY_EVENT);var i={type:s,data:e};return i.options={},i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(debug("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},Socket.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},Socket.prototype.onopen=function(){debug("transport is open - connecting"),"/"!==this.nsp&&(this.query?this.packet({type:parser.CONNECT,query:this.query}):this.packet({type:parser.CONNECT}))},Socket.prototype.onclose=function(t){debug("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},Socket.prototype.onpacket=function(t){if(t.nsp===this.nsp)switch(t.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(t);break;case parser.BINARY_EVENT:this.onevent(t);break;case parser.ACK:this.onack(t);break;case parser.BINARY_ACK:this.onack(t);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",t.data)}},Socket.prototype.onevent=function(t){var e=t.data||[];debug("emitting event %j",e),null!=t.id&&(debug("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?emit.apply(this,e):this.receiveBuffer.push(e)},Socket.prototype.ack=function(t){var e=this,s=!1;return function(){if(!s){s=!0;var i=toArray(arguments);debug("sending ack %j",i);var o=hasBin(i)?parser.BINARY_ACK:parser.ACK;e.packet({type:o,id:t,data:i})}}},Socket.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(debug("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):debug("bad ack %s",t.id)},Socket.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},Socket.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)emit.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},Socket.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},Socket.prototype.close=Socket.prototype.disconnect=function(){return this.connected&&(debug("performing disconnect (%s)",this.nsp),this.packet({type:parser.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},Socket.prototype.compress=function(t){return this.flags=this.flags||{},this.flags.compress=t,this};
},{"./on":49,"component-bind":10,"component-emitter":11,"debug":13,"has-binary":28,"socket.io-parser":53,"to-array":60}],51:[function(require,module,exports){
(function (global){
function url(t,o){var r=t;o=o||global.location,null==t&&(t=o.protocol+"//"+o.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?o.protocol+t:o.host+t),/^(https?|wss?):\/\//.test(t)||(debug("protocol-less url %s",t),t="undefined"!=typeof o?o.protocol+"//"+t:"https://"+t),debug("parse %s",t),r=parseuri(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var p=r.host.indexOf(":")!==-1,e=p?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+e+":"+r.port,r.href=r.protocol+"://"+e+(o&&o.port===r.port?"":":"+r.port),r}var parseuri=require("parseuri"),debug=require("debug")("socket.io-client:url");module.exports=url;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"debug":13,"parseuri":36}],52:[function(require,module,exports){
(function (global){
var isArray=require("isarray"),isBuf=require("./is-buffer");exports.deconstructPacket=function(r){function e(r){if(!r)return r;if(isBuf(r)){var n={_placeholder:!0,num:t.length};return t.push(r),n}if(isArray(r)){for(var a=new Array(r.length),i=0;i<r.length;i++)a[i]=e(r[i]);return a}if("object"==typeof r&&!(r instanceof Date)){var a={};for(var f in r)a[f]=e(r[f]);return a}return r}var t=[],n=r.data,a=r;return a.data=e(n),a.attachments=t.length,{packet:a,buffers:t}},exports.reconstructPacket=function(r,e){function t(r){if(r&&r._placeholder){var n=e[r.num];return n}if(isArray(r)){for(var a=0;a<r.length;a++)r[a]=t(r[a]);return r}if(r&&"object"==typeof r){for(var i in r)r[i]=t(r[i]);return r}return r}return r.data=t(r.data),r.attachments=void 0,r},exports.removeBlobs=function(r,e){function t(r,i,f){if(!r)return r;if(global.Blob&&r instanceof Blob||global.File&&r instanceof File){n++;var o=new FileReader;o.onload=function(){f?f[i]=this.result:a=this.result,--n||e(a)},o.readAsArrayBuffer(r)}else if(isArray(r))for(var u=0;u<r.length;u++)t(r[u],u,r);else if(r&&"object"==typeof r&&!isBuf(r))for(var s in r)t(r[s],s,r)}var n=0,a=r;t(a),n||e(a)};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./is-buffer":54,"isarray":58}],53:[function(require,module,exports){
function Encoder(){}function encodeAsString(r){var e="",t=!1;return e+=r.type,exports.BINARY_EVENT!=r.type&&exports.BINARY_ACK!=r.type||(e+=r.attachments,e+="-"),r.nsp&&"/"!=r.nsp&&(t=!0,e+=r.nsp),null!=r.id&&(t&&(e+=",",t=!1),e+=r.id),null!=r.data&&(t&&(e+=","),e+=json.stringify(r.data)),debug("encoded %j as %s",r,e),e}function encodeAsBinary(r,e){function t(r){var t=binary.deconstructPacket(r),o=encodeAsString(t.packet),n=t.buffers;n.unshift(o),e(n)}binary.removeBlobs(r,t)}function Decoder(){this.reconstructor=null}function decodeString(r){var e={},t=0;if(e.type=Number(r.charAt(0)),null==exports.types[e.type])return error();if(exports.BINARY_EVENT==e.type||exports.BINARY_ACK==e.type){for(var o="";"-"!=r.charAt(++t)&&(o+=r.charAt(t),t!=r.length););if(o!=Number(o)||"-"!=r.charAt(t))throw new Error("Illegal attachments");e.attachments=Number(o)}if("/"==r.charAt(t+1))for(e.nsp="";++t;){var n=r.charAt(t);if(","==n)break;if(e.nsp+=n,t==r.length)break}else e.nsp="/";var s=r.charAt(t+1);if(""!==s&&Number(s)==s){for(e.id="";++t;){var n=r.charAt(t);if(null==n||Number(n)!=n){--t;break}if(e.id+=r.charAt(t),t==r.length)break}e.id=Number(e.id)}return r.charAt(++t)&&(e=tryParse(e,r.substr(t))),debug("decoded %s as %j",r,e),e}function tryParse(r,e){try{r.data=json.parse(e)}catch(r){return error()}return r}function BinaryReconstructor(r){this.reconPack=r,this.buffers=[]}function error(r){return{type:exports.ERROR,data:"parser error"}}var debug=require("debug")("socket.io-parser"),json=require("json3"),Emitter=require("component-emitter"),binary=require("./binary"),isBuf=require("./is-buffer");exports.protocol=4,exports.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],exports.CONNECT=0,exports.DISCONNECT=1,exports.EVENT=2,exports.ACK=3,exports.ERROR=4,exports.BINARY_EVENT=5,exports.BINARY_ACK=6,exports.Encoder=Encoder,exports.Decoder=Decoder,Encoder.prototype.encode=function(r,e){if(debug("encoding packet %j",r),exports.BINARY_EVENT==r.type||exports.BINARY_ACK==r.type)encodeAsBinary(r,e);else{var t=encodeAsString(r);e([t])}},Emitter(Decoder.prototype),Decoder.prototype.add=function(r){var e;if("string"==typeof r)e=decodeString(r),exports.BINARY_EVENT==e.type||exports.BINARY_ACK==e.type?(this.reconstructor=new BinaryReconstructor(e),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",e)):this.emit("decoded",e);else{if(!isBuf(r)&&!r.base64)throw new Error("Unknown type: "+r);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(r),e&&(this.reconstructor=null,this.emit("decoded",e))}},Decoder.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},BinaryReconstructor.prototype.takeBinaryData=function(r){if(this.buffers.push(r),this.buffers.length==this.reconPack.attachments){var e=binary.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};
},{"./binary":52,"./is-buffer":54,"component-emitter":55,"debug":56,"json3":32}],54:[function(require,module,exports){
(function (global){
function isBuf(f){return global.Buffer&&global.Buffer.isBuffer(f)||global.ArrayBuffer&&f instanceof ArrayBuffer}module.exports=isBuf;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],55:[function(require,module,exports){
function Emitter(t){if(t)return mixin(t)}function mixin(t){for(var e in Emitter.prototype)t[e]=Emitter.prototype[e];return t}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},Emitter.prototype.once=function(t,e){function i(){r.off(t,i),e.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},i.fn=e,this.on(t,i),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks[t];if(!i)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var r,s=0;s<i.length;s++)if(r=i[s],r===e||r.fn===e){i.splice(s,1);break}return this},Emitter.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks[t];if(i){i=i.slice(0);for(var r=0,s=i.length;r<s;++r)i[r].apply(this,e)}return this},Emitter.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},Emitter.prototype.hasListeners=function(t){return!!this.listeners(t).length};
},{}],56:[function(require,module,exports){
function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function formatArgs(){var o=arguments,e=this.useColors;if(o[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+o[0]+(e?"%c ":" ")+"+"+exports.humanize(this.diff),!e)return o;var r="color: "+this.color;o=[o[0],r,"color: inherit"].concat(Array.prototype.slice.call(o,1));var t=0,s=0;return o[0].replace(/%[a-z%]/g,function(o){"%%"!==o&&(t++,"%c"===o&&(s=t))}),o.splice(s,0,r),o}function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(o){try{null==o?exports.storage.removeItem("debug"):exports.storage.debug=o}catch(o){}}function load(){var o;try{o=exports.storage.debug}catch(o){}return o}function localstorage(){try{return window.localStorage}catch(o){}}exports=module.exports=require("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(o){return JSON.stringify(o)},exports.enable(load());
},{"./debug":57}],57:[function(require,module,exports){
function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(e){function r(){}function o(){var e=o,r=+new Date,s=r-(prevTime||r);e.diff=s,e.prev=prevTime,e.curr=r,prevTime=r,null==e.useColors&&(e.useColors=exports.useColors()),null==e.color&&e.useColors&&(e.color=selectColor());var t=Array.prototype.slice.call(arguments);t[0]=exports.coerce(t[0]),"string"!=typeof t[0]&&(t=["%o"].concat(t));var n=0;t[0]=t[0].replace(/%([a-z%])/g,function(r,o){if("%%"===r)return r;n++;var s=exports.formatters[o];if("function"==typeof s){var p=t[n];r=s.call(e,p),t.splice(n,1),n--}return r}),"function"==typeof exports.formatArgs&&(t=exports.formatArgs.apply(e,t));var p=o.log||exports.log||console.log.bind(console);p.apply(e,t)}r.enabled=!1,o.enabled=!0;var s=exports.enabled(e)?o:r;return s.namespace=e,s}function enable(e){exports.save(e);for(var r=(e||"").split(/[\s,]+/),o=r.length,s=0;s<o;s++)r[s]&&(e=r[s].replace(/\*/g,".*?"),"-"===e[0]?exports.skips.push(new RegExp("^"+e.substr(1)+"$")):exports.names.push(new RegExp("^"+e+"$")))}function disable(){exports.enable("")}function enabled(e){var r,o;for(r=0,o=exports.skips.length;r<o;r++)if(exports.skips[r].test(e))return!1;for(r=0,o=exports.names.length;r<o;r++)if(exports.names[r].test(e))return!0;return!1}function coerce(e){return e instanceof Error?e.stack||e.message:e}exports=module.exports=debug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevColor=0,prevTime;
},{"ms":59}],58:[function(require,module,exports){
arguments[4][29][0].apply(exports,arguments)
},{"dup":29}],59:[function(require,module,exports){
function parse(e){if(e=""+e,!(e.length>1e4)){var a=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(a){var r=parseFloat(a[1]),c=(a[2]||"ms").toLowerCase();switch(c){case"years":case"year":case"yrs":case"yr":case"y":return r*y;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*h;case"minutes":case"minute":case"mins":case"min":case"m":return r*m;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}}function short(e){return e>=d?Math.round(e/d)+"d":e>=h?Math.round(e/h)+"h":e>=m?Math.round(e/m)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function long(e){return plural(e,d,"day")||plural(e,h,"hour")||plural(e,m,"minute")||plural(e,s,"second")||e+" ms"}function plural(s,e,a){if(!(s<e))return s<1.5*e?Math.floor(s/e)+" "+a:Math.ceil(s/e)+" "+a+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(s,e){return e=e||{},"string"==typeof s?parse(s):e.long?long(s):short(s)};
},{}],60:[function(require,module,exports){
function toArray(r,o){var t=[];o=o||0;for(var a=o||0;a<r.length;a++)t[a-o]=r[a];return t}module.exports=toArray;
},{}],61:[function(require,module,exports){
"use strict";!function(){var e=require("./utils").log,r=require("./utils").browserDetails;module.exports.browserDetails=r,module.exports.extractVersion=require("./utils").extractVersion,module.exports.disableLog=require("./utils").disableLog;var i=require("./chrome/chrome_shim")||null,s=require("./edge/edge_shim")||null,o=require("./firefox/firefox_shim")||null,a=require("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void e("Chrome shim is not included in this adapter release.");e("adapter.js shimming chrome."),module.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!o||!o.shimPeerConnection)return void e("Firefox shim is not included in this adapter release.");e("adapter.js shimming firefox."),module.exports.browserShim=o,o.shimGetUserMedia(),o.shimSourceObject(),o.shimPeerConnection(),o.shimOnTrack();break;case"edge":if(!s||!s.shimPeerConnection)return void e("MS edge shim is not included in this adapter release.");e("adapter.js shimming edge."),module.exports.browserShim=s,s.shimGetUserMedia(),s.shimPeerConnection();break;case"safari":if(!a)return void e("Safari shim is not included in this adapter release.");e("adapter.js shimming safari."),module.exports.browserShim=a,a.shimGetUserMedia();break;default:e("Unsupported browser!")}}();
},{"./chrome/chrome_shim":62,"./edge/edge_shim":64,"./firefox/firefox_shim":66,"./safari/safari_shim":68,"./utils":69}],62:[function(require,module,exports){
"use strict";var logging=require("../utils.js").log,browserDetails=require("../utils.js").browserDetails,chromeShim={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r=new Event("track");r.track=n.track,r.receiver={track:n.track},r.streams=[e.stream],t.dispatchEvent(r)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;return this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),void e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):void(this.src="")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){logging("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),r=n.getStats.bind(n);return n.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r(e,t);var c=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){n[e]=t[e]}),n};if(arguments.length>=2){var s=function(e){o[1](a(c(e)))};return r.apply(this,[s,arguments[0]])}return new Promise(function(t,n){1===o.length&&"object"==typeof e?r.apply(i,[function(e){t(a(c(e)))},n]):r.apply(i,[function(e){t(a(c(e),e.result()))},n])}).then(t,n)},n},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),browserDetails.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};module.exports={shimMediaStream:chromeShim.shimMediaStream,shimOnTrack:chromeShim.shimOnTrack,shimSourceObject:chromeShim.shimSourceObject,shimPeerConnection:chromeShim.shimPeerConnection,shimGetUserMedia:require("./getusermedia")};
},{"../utils.js":69,"./getusermedia":63}],63:[function(require,module,exports){
"use strict";var logging=require("../utils.js").log;module.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var i={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var t="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==t.exact&&"number"==typeof t.exact&&(t.min=t.max=t.exact);var a=function(e,i){return e?e+i.charAt(0).toUpperCase()+i.slice(1):"deviceId"===i?"sourceId":i};if(void 0!==t.ideal){i.optional=i.optional||[];var o={};"number"==typeof t.ideal?(o[a("min",n)]=t.ideal,i.optional.push(o),o={},o[a("max",n)]=t.ideal,i.optional.push(o)):(o[a("",n)]=t.ideal,i.optional.push(o))}void 0!==t.exact&&"number"!=typeof t.exact?(i.mandatory=i.mandatory||{},i.mandatory[a("",n)]=t.exact):["min","max"].forEach(function(e){void 0!==t[e]&&(i.mandatory=i.mandatory||{},i.mandatory[a(e,n)]=t[e])})}}),e.advanced&&(i.optional=(i.optional||[]).concat(e.advanced)),i},i=function(i,n){if(i=JSON.parse(JSON.stringify(i)),i&&i.audio&&(i.audio=e(i.audio)),i&&"object"==typeof i.video){var t=i.video.facingMode;if(t=t&&("object"==typeof t?t:{ideal:t}),t&&("user"===t.exact||"environment"===t.exact||"user"===t.ideal||"environment"===t.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete i.video.facingMode,"environment"===t.exact||"environment"===t.ideal))return navigator.mediaDevices.enumerateDevices().then(function(a){a=a.filter(function(e){return"videoinput"===e.kind});var o=a.find(function(e){return e.label.toLowerCase().indexOf("back")!==-1})||a.length&&a[a.length-1];return o&&(i.video.deviceId=t.exact?{exact:o.deviceId}:{ideal:o.deviceId}),i.video=e(i.video),logging("chrome: "+JSON.stringify(i)),n(i)});i.video=e(i.video)}return logging("chrome: "+JSON.stringify(i)),n(i)},n=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(e,t,a){i(e,function(e){navigator.webkitGetUserMedia(e,t,function(e){a(n(e))})})};navigator.getUserMedia=t;var a=function(e){return new Promise(function(i,n){navigator.getUserMedia(e,i,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,enumerateDevices:function(){return new Promise(function(e){var i={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:i[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return i(e,function(e){return o(e).then(function(i){if(e.audio&&!i.getAudioTracks().length||e.video&&!i.getVideoTracks().length)throw i.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return i},function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return a(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){logging("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){logging("Dummy mediaDevices.removeEventListener called.")})};
},{"../utils.js":69}],64:[function(require,module,exports){
"use strict";var SDPUtils=require("sdp"),browserDetails=require("../utils").browserDetails,edgeShim={shimPeerConnection:function(){if(window.RTCIceGatherer){window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e});var e=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(t){e.set.call(this,t);var n=new Event("enabled");n.enabled=t,this.dispatchEvent(n)}})}window.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var i=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=i.filter(function(e){if(e&&e.urls){var t=e.urls;return"string"==typeof t&&(t=[t]),t=t.filter(function(e){return 0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1||0===e.indexOf("stun:")&&browserDetails.version>=14393})[0],!!t}return!1})}this._config=e,this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=SDPUtils.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){var i=!n.candidate||0===Object.keys(n.candidate).length;if(i)for(var r=1;r<t.length;r++)t[r].indexOf("\r\na=end-of-candidates\r\n")===-1&&(t[r]+="a=end-of-candidates\r\n");else n.candidate.candidate.indexOf("typ endOfCandidates")===-1&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");if(e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),!n.candidate&&"complete"!==e.iceGatheringState){var a=e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});a&&(e.iceGatheringState="complete")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.getConfiguration=function(){return this._config},window.RTCPeerConnection.prototype.addStream=function(e){var t=e.clone();e.getTracks().forEach(function(e,n){var i=t.getTracks()[n];e.addEventListener("enabled",function(e){i.enabled=e.enabled})}),this.localStreams.push(t),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var i=0;i<t.codecs.length;i++){var r=t.codecs[i];if(e.name.toLowerCase()===r.name.toLowerCase()&&e.clockRate===r.clockRate){r.numChannels=Math.min(e.numChannels,r.numChannels),n.codecs.push(r),r.rtcpFeedback=r.rtcpFeedback.filter(function(t){for(var n=0;n<e.rtcpFeedback.length;n++)if(e.rtcpFeedback[n].type===t.type&&e.rtcpFeedback[n].parameter===t.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var n=this,i=new RTCIceGatherer(n.iceOptions),r=new RTCIceTransport(i);i.onlocalcandidate=function(a){var o=new Event("icecandidate");o.candidate={sdpMid:e,sdpMLineIndex:t};var s=a.candidate,c=!s||0===Object.keys(s).length;c?(void 0===i.state&&(i.state="completed"),o.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(s.component="RTCP"===r.component?2:1,o.candidate.candidate=SDPUtils.writeCandidate(s));var d=SDPUtils.splitSections(n.localDescription.sdp);o.candidate.candidate.indexOf("typ endOfCandidates")===-1?d[o.candidate.sdpMLineIndex+1]+="a="+o.candidate.candidate+"\r\n":d[o.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",n.localDescription.sdp=d.join("");var l=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":n._localIceCandidatesBuffer.push(o),c&&l&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),n.dispatchEvent(o),null!==n.onicecandidate&&n.onicecandidate(o),l&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete");break;case"complete":}},r.onicestatechange=function(){n._updateConnectionState()};var a=new RTCDtlsTransport(r);return a.ondtlsstatechange=function(){n._updateConnectionState()},a.onerror=function(){a.state="failed",n._updateConnectionState()},{iceGatherer:i,iceTransport:r,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var i=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:SDPUtils.localCName},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,n,i=this;if("offer"===e.type)this._pendingOffer&&(t=SDPUtils.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=SDPUtils.parseRtpParameters(e);i._pendingOffer[t].localCapabilities=n}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=SDPUtils.splitSections(i.remoteDescription.sdp),n=t.shift();var r=SDPUtils.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],o=a.iceGatherer,s=a.iceTransport,c=a.dtlsTransport,d=a.localCapabilities,l=a.remoteCapabilities,p="0"===e.split("\n",1)[0].split(" ",2)[1];if(!p&&!a.isDatachannel){var f=SDPUtils.getIceParameters(e,n);if(r){var h=SDPUtils.matchPrefix(e,"a=candidate:").map(function(e){return SDPUtils.parseCandidate(e)}).filter(function(e){return"1"===e.component});h.length&&s.setRemoteCandidates(h)}var u=SDPUtils.getDtlsParameters(e,n);r&&(u.role="server"),i.usingBundle&&0!==t||(s.start(o,f,r?"controlling":"controlled"),c.start(u));var m=i._getCommonCapabilities(d,l);i._transceive(a,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var o=arguments[1];window.setTimeout(function(){o(),"new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),i._emitBufferedCandidates()},0)}var s=Promise.resolve();return s.then(function(){a||("new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),window.setTimeout(i._emitBufferedCandidates.bind(i),500))}),s},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,i=[],r=SDPUtils.splitSections(e.sdp),a=r.shift(),o=SDPUtils.matchPrefix(a,"a=ice-lite").length>0;switch(this.usingBundle=SDPUtils.matchPrefix(a,"a=group:BUNDLE ").length>0,r.forEach(function(r,s){var c=SDPUtils.splitLines(r),d=c[0].substr(2).split(" "),l=d[0],p="0"===d[1],f=SDPUtils.getDirection(r,a),h=SDPUtils.matchPrefix(r,"a=mid:");if(h=h.length?h[0].substr(6):SDPUtils.generateIdentifier(),"application"===l&&"DTLS/SCTP"===d[2])return void(t.transceivers[s]={mid:h,isDatachannel:!0});var u,m,v,g,w,S,C,T,P,y,R,D,E=SDPUtils.parseRtpParameters(r);p||(R=SDPUtils.getIceParameters(r,a),D=SDPUtils.getDtlsParameters(r,a),D.role="client"),T=SDPUtils.parseRtpEncodingParameters(r);var b,k=SDPUtils.matchPrefix(r,"a=ssrc:").map(function(e){return SDPUtils.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];k&&(b=k.value);var _=SDPUtils.matchPrefix(r,"a=end-of-candidates",a).length>0,U=SDPUtils.matchPrefix(r,"a=candidate:").map(function(e){return SDPUtils.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||p)"answer"!==e.type||p||(u=t.transceivers[s],m=u.iceGatherer,v=u.iceTransport,g=u.dtlsTransport,w=u.rtpSender,S=u.rtpReceiver,C=u.sendEncodingParameters,P=u.localCapabilities,t.transceivers[s].recvEncodingParameters=T,t.transceivers[s].remoteCapabilities=E,t.transceivers[s].cname=b,(o||_)&&U.length&&v.setRemoteCandidates(U),t.usingBundle&&0!==s||(v.start(m,R,"controlling"),g.start(D)),t._transceive(u,"sendrecv"===f||"recvonly"===f,"sendrecv"===f||"sendonly"===f),!S||"sendrecv"!==f&&"sendonly"!==f?delete u.rtpReceiver:(y=S.track,i.push([y,S]),n.addTrack(y)));else{var O=t.usingBundle&&s>0?{iceGatherer:t.transceivers[0].iceGatherer,iceTransport:t.transceivers[0].iceTransport,dtlsTransport:t.transceivers[0].dtlsTransport}:t._createIceAndDtlsTransports(h,s);if(_&&O.iceTransport.setRemoteCandidates(U),P=RTCRtpReceiver.getCapabilities(l),P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name}),C=[{ssrc:1001*(2*s+2)}],S=new RTCRtpReceiver(O.dtlsTransport,l),y=S.track,i.push([y,S]),n.addTrack(y),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=s){var x;"audio"===l?x=t.localStreams[0].getAudioTracks()[0]:"video"===l&&(x=t.localStreams[0].getVideoTracks()[0]),x&&(w=new RTCRtpSender(x,O.dtlsTransport))}t.transceivers[s]={iceGatherer:O.iceGatherer,iceTransport:O.iceTransport,dtlsTransport:O.dtlsTransport,localCapabilities:P,remoteCapabilities:E,rtpSender:w,rtpReceiver:S,kind:l,mid:h,cname:b,sendEncodingParameters:C,recvEncodingParameters:T},t._transceive(t.transceivers[s],!1,"sendrecv"===f||"sendonly"===f)}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){var e=new Event("addstream");e.stream=n,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),i.forEach(function(i){var r=i[0],a=i[1],o=new Event("track");o.track=r,o.receiver=a,o.streams=[n],t.dispatchEvent(e),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(o)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this.dispatchEvent(i),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(i)}},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var n=[],i=0,r=0;if(this.localStreams.length&&(i=this.localStreams[0].getAudioTracks().length,r=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(i=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(r=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?i>0:r>0}),"audio"===e.kind?i--:"video"===e.kind&&r--});i>0||r>0;)i>0&&(n.push({kind:"audio",wantReceive:!0}),i--),r>0&&(n.push({kind:"video",wantReceive:!0}),r--);var a=SDPUtils.writeSessionBoilerplate(),o=[];n.forEach(function(t,n){var i=t.track,r=t.kind,a=SDPUtils.generateIdentifier(),s=e.usingBundle&&n>0?{iceGatherer:o[0].iceGatherer,iceTransport:o[0].iceTransport,dtlsTransport:o[0].dtlsTransport}:e._createIceAndDtlsTransports(a,n),c=RTCRtpSender.getCapabilities(r);c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name}),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var d,l,p=[{ssrc:1001*(2*n+1)}];i&&(d=new RTCRtpSender(i,s.dtlsTransport)),t.wantReceive&&(l=new RTCRtpReceiver(s.dtlsTransport,r)),o[n]={iceGatherer:s.iceGatherer,iceTransport:s.iceTransport,dtlsTransport:s.dtlsTransport,localCapabilities:c,remoteCapabilities:null,rtpSender:d,rtpReceiver:l,kind:r,mid:a,sendEncodingParameters:p,recvEncodingParameters:null}}),this.usingBundle&&(a+="a=group:BUNDLE "+o.map(function(e){return e.mid}).join(" ")+"\r\n"),n.forEach(function(t,n){var i=o[n];a+=SDPUtils.writeMediaSection(i,i.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=o;var s=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,s),Promise.resolve(s)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=SDPUtils.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n){if(n.isDatachannel)return void(t+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+n.mid+"\r\n");var i=e._getCommonCapabilities(n.localCapabilities,n.remoteCapabilities);t+=SDPUtils.writeMediaSection(n,i,"answer",e.localStreams[0])});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var i=this.transceivers[t];if(i){var r=Object.keys(e.candidate).length>0?SDPUtils.parseCandidate(e.candidate):{};if("tcp"===r.protocol&&(0===r.port||9===r.port))return;if("1"!==r.component)return;"endOfCandidates"===r.type&&(r={}),i.iceTransport.addRemoteCandidate(r);var a=SDPUtils.splitSections(this.remoteDescription.sdp);a[t+1]+=(r.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}else this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){i.set(t,e[t]),i[t]=e[t]})}),t&&window.setTimeout(t,0,i),n(i)})})}}};module.exports={shimPeerConnection:edgeShim.shimPeerConnection,shimGetUserMedia:require("./getusermedia")};
},{"../utils":69,"./getusermedia":65,"sdp":46}],65:[function(require,module,exports){
"use strict";module.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},n=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(r){return n(r).catch(function(n){return Promise.reject(e(n))})}};
},{}],66:[function(require,module,exports){
"use strict";var browserDetails=require("../utils").browserDetails,firefoxShim={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(browserDetails.version<38&&e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var o=e.iceServers[r];if(o.hasOwnProperty("urls"))for(var i=0;i<o.urls.length;i++){var c={url:o.urls[i]};0===o.urls[i].indexOf("turn")&&(c.username=o.username,c.credential=o.credential),n.push(c)}else n.push(e.iceServers[r])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;if(RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},browserDetails.version<48){var t=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},n=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,r,o){return n.apply(this,[e||null]).then(function(e){return t(e)}).then(r,o)}}}}};module.exports={shimOnTrack:firefoxShim.shimOnTrack,shimSourceObject:firefoxShim.shimSourceObject,shimPeerConnection:firefoxShim.shimPeerConnection,shimGetUserMedia:require("./getusermedia")};
},{"../utils":69,"./getusermedia":67}],67:[function(require,module,exports){
"use strict";var logging=require("../utils").log,browserDetails=require("../utils").browserDetails;module.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(i,r,t){var n=function(e){if("object"!=typeof e||e.require)return e;var i=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var t=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===t.min&&void 0===t.max&&void 0===t.exact||i.push(r),void 0!==t.exact&&("number"==typeof t.exact?t.min=t.max=t.exact:e[r]=t.exact,delete t.exact),void 0!==t.ideal){e.advanced=e.advanced||[];var n={};"number"==typeof t.ideal?n[r]={min:t.ideal,max:t.ideal}:n[r]=t.ideal,e.advanced.push(n),delete t.ideal,Object.keys(t).length||delete e[r]}}}),i.length&&(e.require=i),e};return i=JSON.parse(JSON.stringify(i)),browserDetails.version<38&&(logging("spec: "+JSON.stringify(i)),i.audio&&(i.audio=n(i.audio)),i.video&&(i.video=n(i.video)),logging("ff37: "+JSON.stringify(i))),navigator.mozGetUserMedia(i,r,function(i){t(e(i))})},r=function(e){return new Promise(function(r,t){i(e,r,t)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:r,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var i=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(i)})},browserDetails.version<41){var t=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return t().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(browserDetails.version<49){var n=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(i){return n(i).then(function(e){if(i.audio&&!e.getAudioTracks().length||i.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(i){return Promise.reject(e(i))})}}navigator.getUserMedia=function(e,r,t){return browserDetails.version<44?i(e,r,t):(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),void navigator.mediaDevices.getUserMedia(e).then(r,t))}};
},{"../utils":69}],68:[function(require,module,exports){
"use strict";var safariShim={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};module.exports={shimGetUserMedia:safariShim.shimGetUserMedia};
},{}],69:[function(require,module,exports){
"use strict";var logDisabled_=!0,utils={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(logDisabled_=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(logDisabled_)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,r,o){var t=e.match(r);return t&&t.length>=o&&parseInt(t[o],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}};module.exports={log:utils.log,disableLog:utils.disableLog,browserDetails:utils.detectBrowser(),extractVersion:utils.extractVersion};
},{}],70:[function(require,module,exports){
(function (global){
!function(r){function e(r){for(var e,n,t=[],o=0,i=r.length;o<i;)e=r.charCodeAt(o++),e>=55296&&e<=56319&&o<i?(n=r.charCodeAt(o++),56320==(64512&n)?t.push(((1023&e)<<10)+(1023&n)+65536):(t.push(e),o--)):t.push(e);return t}function n(r){for(var e,n=r.length,t=-1,o="";++t<n;)e=r[t],e>65535&&(e-=65536,o+=s(e>>>10&1023|55296),e=56320|1023&e),o+=s(e);return o}function t(r,e){return s(r>>e&63|128)}function o(r){if(0==(4294967168&r))return s(r);var e="";return 0==(4294965248&r)?e=s(r>>6&31|192):0==(4294901760&r)?(e=s(r>>12&15|224),e+=t(r,6)):0==(4292870144&r)&&(e=s(r>>18&7|240),e+=t(r,12),e+=t(r,6)),e+=s(63&r|128)}function i(r){for(var n,t=e(r),i=t.length,f=-1,u="";++f<i;)n=t[f],u+=o(n);return u}function f(){if(p>=v)throw Error("Invalid byte index");var r=255&h[p];if(p++,128==(192&r))return 63&r;throw Error("Invalid continuation byte")}function u(){var r,e,n,t,o;if(p>v)throw Error("Invalid byte index");if(p==v)return!1;if(r=255&h[p],p++,0==(128&r))return r;if(192==(224&r)){var e=f();if(o=(31&r)<<6|e,o>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&r)){if(e=f(),n=f(),o=(15&r)<<12|e<<6|n,o>=2048)return o;throw Error("Invalid continuation byte")}if(240==(248&r)&&(e=f(),n=f(),t=f(),o=(15&r)<<18|e<<12|n<<6|t,o>=65536&&o<=1114111))return o;throw Error("Invalid WTF-8 detected")}function a(r){h=e(r),v=h.length,p=0;for(var t,o=[];(t=u())!==!1;)o.push(t);return n(o)}var d="object"==typeof exports&&exports,l="object"==typeof module&&module&&module.exports==d&&module,c="object"==typeof global&&global;c.global!==c&&c.window!==c||(r=c);var h,v,p,s=String.fromCharCode,b={version:"1.0.0",encode:i,decode:a};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return b});else if(d&&!d.nodeType)if(l)l.exports=b;else{var y={},w=y.hasOwnProperty;for(var g in b)w.call(b,g)&&(d[g]=b[g])}else r.wtf8=b}(this);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],71:[function(require,module,exports){
"use strict";function encode(e){var t="";do t=alphabet[e%length]+t,e=Math.floor(e/length);while(e>0);return t}function decode(e){var t=0;for(i=0;i<e.length;i++)t=t*length+map[e.charAt(i)];return t}function yeast(){var e=encode(+new Date);return e!==prev?(seed=0,prev=e):e+"."+encode(seed++)}for(var alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0,prev;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode,yeast.decode=decode,module.exports=yeast;
},{}],72:[function(require,module,exports){
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),events=require("eventemitter2"),adapter=require("webrtc-adapter"),EventEmitter=events.EventEmitter2;module.exports=function(e){function n(e,t){_classCallCheck(this,n);var r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.logger=console,r.config=e||{},r.config.iceServers=r.config.iceServers||[],r.config.constraints=r.config.constraints||{offerToReceiveAudio:1,offerToReceiveVideo:1},r.config.mediaAnswerConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},r.id=r.config.id,r.sid=r.config.sid||Date.now().toString(),r.parent=r.config.parent,r.localStream=r.parent.localStream,r.stream=null,r.pc=r.createRTCPeerConnection(r.parent.config.peerConnectionConfig,r.parent.config.peerConnectionConstraints),r.addStream(r.localStream),r.getLocalStreams=r.pc.getLocalStreams.bind(r.pc),r.getRemoteStreams=r.pc.getRemoteStreams.bind(r.pc),r.pc.onaddstream=r.emit.bind(r,"addStream"),r.pc.onremovestream=r.emit.bind(r,"removeStream"),r.pc.onnegotiationneeded=r.emit.bind(r,"negotiationNeeded"),r.pc.onicecandidate=r._onIceCandidate.bind(r),r.pc.ondatachannel=r._onDataChannel.bind(r),r.onAny(function(e,n){r.logger.debug("PeerConnection onAny event:",e,n),r.parent.emit.call(r.parent,e,n)}),r.on("offer",function(e){r.logger.info("send msg offer",e),r.send("offer",e)}),r.on("answer",function(e){r.send("answer",e)}),r.on("iceCandidate",function(e){r.send("iceCandidate",e)}),r.on("iceEnd",function(e){r.parent.emit("iceEnd",r,e)}),r.on("addStream",function(e){var n=e.stream;r.stream=n,r.stream.psid=(r.id||r.sid)+"_"+r.stream.id;var t=!0,i=!1,a=void 0;try{for(var o,s=function(){var e=o.value;e.addEventListener("ended",function(){r.isAllTracksEnded(r.stream)&&(r.logger.debug("stream ended, id:",r.id),r.end(n)),r.parent.emit("removetrack",e)})},c=r.stream.getTracks()[Symbol.iterator]();!(t=(o=c.next()).done);t=!0)s()}catch(e){i=!0,a=e}finally{try{!t&&c.return&&c.return()}finally{if(i)throw a}}r.stream.addEventListener("addtrack",function(e){var t=e.track;r.logger.debug('stream "addtrack" event [track:%o]',t),r.parent.emit("addtrack",t),t.addEventListener("ended",function(){r.isAllTracksEnded(r.stream)&&(r.logger.debug("stream ended, id:",r.id,t),r.end(n)),r.parent.emit("removetrack",t)})}),r.parent.emit("peerStreamAdded",r,n)}),r}return _inherits(n,e),_createClass(n,[{key:"isSupportsPeerConnections",value:function(){return"undefined"!=typeof RTCPeerConnection}},{key:"isAllTracksEnded",value:function(e){var n=!0,t=!1,r=void 0;try{for(var i,a=e.getTracks()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var o=i.value;if("ended"!==o.readyState)return!1}}catch(e){t=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(t)throw r}}return!0}},{key:"createRTCPeerConnection",value:function(e,n){if(this.isSupportsPeerConnections())return new RTCPeerConnection(e,n);throw"The browser does not support WebRTC (RTCPeerConnection)"}},{key:"start",value:function(){this.offer(this.config.constraints)}},{key:"end",value:function(e){if(!this.isClosed){var n=this.parent.emit("peerStreamRemoved",this,e);n||(this.close(),this.isClosed=!0,this.parent.removePeerConnection(this))}}},{key:"offer",value:function(e,n){var t=this,r=this._safeCallback(n),i=e||this.config.constraints;return"closed"===this.pc.signalingState?r("Signaling state is closed"):void this.pc.createOffer(function(e){var i={type:"offer",sdp:e.sdp};return t.config.connectMediaServer?t.emit("offer",i):void t.pc.setLocalDescription(e,function(){t.logger.debug("create offer success"),n?r(null,i):t.emit("offer",i)},function(e){t.emit("error",e),r(e)})},function(e){t.emit("error",e),r(e)},i)}},{key:"answer",value:function(e,n){var t=this;n=this._safeCallback(n);var r=e||this.config.mediaAnswerConstraints;return"closed"===this.pc.signalingState?n("Signaling state is closed"):void this.pc.createAnswer(function(e){var r={type:"answer",sdp:e.sdp};t.pc.setLocalDescription(e,function(){t.logger.debug("create answer success"),t.emit("answer",r),n(null,r)},function(e){t.emit("error",e),n(e)})},function(e){t.emit("error",e),n(e)},r)}},{key:"processMessage",value:function(e){var n=this;this.logger.debug("Preparing proccess peer message",e.type,e),"offer"===e.type?this.processMsgOffer(e.payload,function(t){t?n.logger.error("Cannot process msgOffer:",t):n.answer(n.config.mediaAnswerConstraints,function(t){t?n.logger.error("Cannot create an answer message",t,e):n.logger.info("Sent the answer message to ",e)})}):"answer"===e.type?this.processMsgAnswer(e.payload,function(t){t&&n.logger.error("Cannot process msgAnswer:",t,e)}):"iceCandidate"===e.type?this.processMsgCandidate(e.payload,function(t){t&&n.logger.error("Cannot process msgCandidate:",t,e)}):"welcome"===e.type?this.emit("welcome",e):this.logger.warn("Unknow message",e)}},{key:"processMsgOffer",value:function(e,n){n=this._safeCallback(n);var t=new RTCSessionDescription(e);this.pc.setRemoteDescription(t,function(){n(null)},function(e){n(e)})}},{key:"processMsgAnswer",value:function(e,n){n=this._safeCallback(n);var t=new RTCSessionDescription(e);this.pc.setRemoteDescription(t,function(){n(null)},function(e){n(e)})}},{key:"processMsgCandidate",value:function(e,n){var t=this;n=this._safeCallback(n),e.candidate&&0!==e.candidate.candidate.indexOf("a=")&&(e.candidate.candidate="a="+e.candidate.candidate);var r=new RTCIceCandidate(e.candidate);this.pc.addIceCandidate(r,function(){},function(e){t.emit("error",e)}),n(null)}},{key:"close",value:function(){this.pc.close(),this.emit("close")}},{key:"addStream",value:function(e){return e?(this.logger.debug("Got the stream!"),this.localStream=e,void this.pc.addStream(e)):this.logger.warn("Stream must not be null")}},{key:"_safeCallback",value:function(e){return e||function(){return 1}}},{key:"_onIceCandidate",value:function(e){if(e.candidate){if(this.config.connectMediaServer)return void this.logger.debug("Dont send ice candidate: ",this.id);var n=e.candidate,t={candidate:{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}};this.emit("iceCandidate",t)}else{this.logger.debug("iceEnd_onIceCandidate",e);var r={type:"offer",sdp:this.pc.localDescription.sdp};this.emit("iceEnd",r)}}},{key:"_onDataChannel",value:function(e){var n=e.channel;this.logger.debug("add new channel:",n),this.emit("addChannel",n)}},{key:"send",value:function(e,n){var t={to:this.id,sid:this.sid,type:e,payload:n};this.logger.debug("sending",e,t),this.parent.emit("message",t)}}]),n}(EventEmitter);
},{"eventemitter2":27,"webrtc-adapter":61}],73:[function(require,module,exports){
"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,o){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?e:o}function _inherits(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}var _createClass=function(){function e(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(o,t,n){return t&&e(o.prototype,t),n&&e(o,n),o}}(),events=require("eventemitter2"),adapter=require("webrtc-adapter"),socketio=require("socket.io-client"),Promise=require("promise"),WebRTC=require("./webrtc"),EventEmitter=events.EventEmitter2;module.exports=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));t.self=t,t.logger=console,t.options=e||{},t.connection=null,t.connectionReady=!1,t.roomName=null,t.localStream=null,t.config={autoConnect:!0,autoCallPeers:!0,connectMediaServer:!1,username:!1,url:"https://roomrtc-signaling-server.herokuapp.com",media:{audio:!1,video:!0},peerMediaConstraints:{offerToReceiveVideo:!0,offerToReceiveAudio:!0},localVideo:{autoplay:!0,mirror:!0,muted:!0}};for(var n in t.options)t.options.hasOwnProperty(n)&&(t.config[n]=t.options[n]);return t.webrtc=new WebRTC,t.webrtc.on("peerStreamAdded",t.handlePeerStreamAdded.bind(t)),t.webrtc.on("peerStreamRemoved",t.handlePeerStreamRemoved.bind(t)),t.webrtc.on("message",function(e){t.logger.debug("send message command",e),t.connection.emit("message",e)}),t.webrtc.onAny(function(e,o){t.emit.call(t,e,o)}),t.onAny(t.logger.debug.bind(t.logger,"RoomRTC event:")),t.config.autoConnect&&t.connect(),t}return _inherits(o,e),_createClass(o,[{key:"connect",value:function(){var e=this;this.connection=socketio.connect(this.config.url),this.connection.on("connect",function(){e.connectionReady=!0,e.connectionId=e.connection.id,e.emit("connected",e.connectionId)}),this.connection.on("message",function(o){if("offer"==o.type){var t=e.webrtc.peers.find(function(e){return e.id===o.from});t||(e.logger.debug("Creating a new peer connection to:",o.from),t=e.webrtc.createPeerConnection({id:o.from,sid:o.sid}),e.emit("peerCreated",t)),t.processMessage(o)}else{var n=e.webrtc.peers;n.forEach(function(e){o.sid?e.sid===o.sid&&e.processMessage(o):e.processMessage(o)})}}),this.connection.on("ready",function(o){e.emit("readyToCall",e.connectionId)}),this.connection.on("remove",function(o){e.logger.info("removePeerConnectionById",o),e.webrtc.removePeerConnectionById(o.id)}),this.connection.on("iceservers",function(o){e.logger.debug("Got iceservers info",o)})}},{key:"disconnect",value:function(){this.connection&&(this.connection.disconnect(),delete this.connection)}},{key:"verifyReady",value:function(){this.connectionReady&&(this.config.connectMediaServer?this.emit("readyToJoinMediaServer",this.connectionId):this.emit("readyToCall",this.connectionId))}},{key:"joinRoom",value:function(e){var o=this;return e?(this.roomName=e,new Promise(function(t,n){o.connection.emit("join",e,function(r,i){if(o.logger.debug("join callback: ",r,i),r)return o.emit("error",r),n(r);if(!o.config.connectMediaServer&&o.config.autoCallPeers){var c=i.clients||[];for(var a in c){var s=o.webrtc.createPeerConnection({id:a});o.emit("peerCreated",s),s.start()}return o.emit("roomJoined",e),t(i)}return o.logger.info("joinRoom media server ok!"),t(i)})})):Promise.reject("No room to join")}},{key:"joinMediaServer",value:function(e){var o=this;return e?(this.roomName=e,Promise.resolve().then(function(){var e=(o.config.username||o.connectionId,o.webrtc.createPeerConnection({id:o.connectionId,connectMediaServer:o.config.connectMediaServer}));o.emit("peerCreated",e),e.start()})):Promise.reject("No room to join")}},{key:"createRoom",value:function(e){var o=this;return e?new Promise(function(t,n){o.connection.emit("create",e,function(e,n){return e?void o.emit("error",e):(o.roomName=n,o.emit("roomCreated",n),t(n))})}):Promise.reject("No room to create")}},{key:"initMediaSource",value:function(e,o){var t=this;this.logger.debug("Requesting local media ...");var n=e||this.config.media;return navigator.mediaDevices.getUserMedia(n).then(function(e){return t.localStream=e,t.webrtc.addLocalStream(e),e})}},{key:"stop",value:function(e){e=e||this.localStream,this.stopStream(e)}},{key:"stopStream",value:function(e){if(e){var o=!0,t=!1,n=void 0;try{for(var r,i=e.getAudioTracks()[Symbol.iterator]();!(o=(r=i.next()).done);o=!0){var c=r.value;try{c.stop()}catch(e){this.logger.debug("stop audio track error:",e)}}}catch(e){t=!0,n=e}finally{try{!o&&i.return&&i.return()}finally{if(t)throw n}}var a=!0,s=!1,u=void 0;try{for(var d,l=e.getVideoTracks()[Symbol.iterator]();!(a=(d=l.next()).done);a=!0){var f=d.value;try{f.stop()}catch(e){this.logger.debug("stop video track error:",e)}}}catch(e){s=!0,u=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw u}}if("function"==typeof e.stop)try{e.stop()}catch(e){}}}},{key:"getStreamAsUrl",value:function(e){var o=window.URL||window.webkitURL;return o.createObjectURL(e)}},{key:"revokeObjectURL",value:function(e){var o=window.URL||window.webkitURL;o.revokeObjectURL(e)}},{key:"handlePeerStreamAdded",value:function(e,o){var t=o&&o.id;this.logger.debug("A new remote video added:",e.id,t),this.emit("videoAdded",e,o)}},{key:"handlePeerStreamRemoved",value:function(e,o){var t=o&&o.id;this.logger.debug("A remote video removed:",e.id,t),this.emit("videoRemoved",e,o)}}]),o}(EventEmitter);
},{"./webrtc":74,"eventemitter2":27,"promise":38,"socket.io-client":47,"webrtc-adapter":61}],74:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),events=require("eventemitter2"),adapter=require("webrtc-adapter"),browser=require("bowser"),PeerConnection=require("./peerconnection"),EventEmitter=events.EventEmitter2;module.exports=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.self=r,r.logger=console,r.config={peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0},r.peers=[],r.localStreams=[],r}return _inherits(t,e),_createClass(t,[{key:"_removeStream",value:function(e){var t=this.localStreams.indexOf(e);t>-1&&this.localStream.splice(t,1)}},{key:"setPeerConnectionConfig",value:function(e,t){this.config.peerConnectionConfig=e,this.config.peerConnectionConstraints=t}},{key:"isAllTracksEnded",value:function(e){var t=!0,r=!0,n=!1,o=void 0;try{for(var i,a=e.getTracks()[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var c=i.value;if("ended"!==c.readyState){t=!1;break}}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return t}},{key:"addLocalStream",value:function(e){this.localStreams.push(e)}},{key:"createPeerConnection",value:function(e){e=e||{},e.parent=this;var t=new PeerConnection(e);return this.peers.push(t),t}},{key:"removePeerConnection",value:function(e){var t=this.peers.indexOf(e);t&&this.peers.splice(t,1)}},{key:"removePeerConnectionById",value:function(e){this.peers.some(function(t){if(t.id==e)return t.end(),!0})}},{key:"isPlanB",value:function(){return!!(browser.chrome||browser.chromium||browser.opera)}},{key:"localStream",get:function(){return this.localStreams.length>0?this.localStreams[0]:null}}]),t}(EventEmitter);
},{"./peerconnection":72,"bowser":8,"eventemitter2":27,"webrtc-adapter":61}]},{},[73])(73)
});